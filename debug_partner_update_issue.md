# Отладка проблемы с обновлением данных партнера

## Текущая ситуация

✅ Политики RLS созданы:
- `Allow anon to update partners` - для таблицы `partners`
- `Allow anon to update partner_applications` - для таблицы `partner_applications`

## Возможные причины проблемы

### 1. Партнер находится в таблице `partners`, а не в `partner_applications`

Логика в `updatePartnerInfo`:
- Сначала проверяет наличие в `partners`
- Если найден в `partners` → обновляет `partners` (и убирает поле `phone`)
- Если не найден → обновляет `partner_applications`

**Проблема**: Если партнер одобрен (есть в `partners`), но политика для `partners` не работает правильно, обновление не пройдет.

### 2. Поле `phone` удаляется при обновлении `partners`

В коде есть строка:
```javascript
const { phone, ...updateDataForPartners } = updateData
```

Это означает, что при обновлении `partners` поле `phone` не обновляется, даже если пользователь его изменил.

### 3. Ошибка может быть не связана с RLS

Возможные причины:
- Поля, которые пытаются обновить, не существуют в таблице
- Ограничения NOT NULL или CHECK constraints
- Триггеры, которые блокируют обновление

## Что нужно проверить

1. **Откройте консоль браузера (F12)** при попытке сохранить данные
2. **Проверьте логи** - должны быть сообщения:
   - `[PartnerAnalytics] Saving partner data:`
   - `[PartnerAnalytics] Update result:`
   - Или ошибка с деталями

3. **Проверьте, в какой таблице находится партнер:**
   - Выполните запрос из `test_partner_update.sql`, заменив `YOUR_PARTNER_CHAT_ID` на реальный ID

4. **Проверьте структуру таблиц:**
   - Убедитесь, что все поля, которые пытаются обновить, существуют в таблице

## Решение

Если проблема в том, что партнер находится в `partners`, но обновление не работает:

1. Проверьте, что политика `Allow anon to update partners` действительно активна
2. Проверьте консоль браузера на наличие ошибок
3. Возможно, нужно также обновлять `partner_applications`, даже если партнер одобрен
