# üéÅ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Å–≤—è–∑–∏ –∞–∫—Ü–∏–π —Å —É—Å–ª—É–≥–∞–º–∏

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `add_promotion_services_relation.sql`
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ (Run)

**–ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ:**
- –ü–æ–ª–µ `promotion_type` –≤ —Ç–∞–±–ª–∏—Ü–µ `promotions`
- –¢–∞–±–ª–∏—Ü–∞ `promotion_services` (—Å–≤—è–∑—å Many-to-Many)
- –§—É–Ω–∫—Ü–∏–∏ –ë–î –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ü–∏–π/—É—Å–ª—É–≥
- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—è promotion_type
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'promotions' AND column_name = 'promotion_type';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã promotion_services
SELECT * FROM promotion_services LIMIT 1;
```

---

## üéØ –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∞–∫—Ü–∏—é –¥–ª—è –æ–±–º–µ–Ω–∞ –±–∞–ª–ª–æ–≤

### –ß–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –±–æ—Ç:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –±–æ—Ç –≤ Telegram
2. –í—ã–±–µ—Ä–∏—Ç–µ "üéÅ –ú–æ–∏ –∞–∫—Ü–∏–∏" ‚Üí "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ü–∏—é"
3. **–®–∞–≥ 1:** –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∞–∫—Ü–∏–∏ ‚Üí "üí∏ –û–±–º–µ–Ω –±–∞–ª–ª–æ–≤ –Ω–∞ —É—Å–ª—É–≥–∏"
4. **–®–∞–≥ 2:** –í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–û–±–º–µ–Ω –±–∞–ª–ª–æ–≤ –Ω–∞ –º–∞–Ω–∏–∫—é—Ä")
5. **–®–∞–≥ 3:** –í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ
6. **–®–∞–≥ 4:** –í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏/–±–æ–Ω—É—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "100 –±–∞–ª–ª–æ–≤")
7. **–®–∞–≥ 5:** –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è (–î–î.–ú–ú.–ì–ì–ì–ì)
8. **–®–∞–≥ 6:** –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
9. **–®–∞–≥ 7:** –£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø–ª–∞—Ç—ã –±–∞–ª–ª–∞–º–∏:
   - –°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏: `100` (–¥–æ–ª–ª–∞—Ä–æ–≤)
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –±–∞–ª–ª–∞–º–∏: `50` (–¥–æ–ª–ª–∞—Ä–æ–≤)
   - –ö—É—Ä—Å –æ–±–º–µ–Ω–∞: `1.0` (1 –±–∞–ª–ª = $1)
10. **–®–∞–≥ 8:** –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ)

**–ì–æ—Ç–æ–≤–æ!** –ê–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —É—Å–ª—É–≥–∞–º.

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å –∞–∫—Ü–∏–π —Å —É—Å–ª—É–≥–∞–º–∏

### –ß–µ—Ä–µ–∑ SQL:

```sql
-- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ü–∏–∏ —Å –∏—Ö —É—Å–ª—É–≥–∞–º–∏
SELECT 
    p.id,
    p.title,
    p.promotion_type,
    s.id as service_id,
    s.title as service_title
FROM promotions p
LEFT JOIN promotion_services ps ON p.id = ps.promotion_id
LEFT JOIN services s ON ps.service_id = s.id
WHERE p.promotion_type = 'points_redemption'
ORDER BY p.id;

-- –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —É—Å–ª—É–≥–∏
SELECT * FROM get_promotions_for_service('UUID_–£–°–õ–£–ì–ò');

-- –ü–æ–ª—É—á–∏—Ç—å —É—Å–ª—É–≥–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∞–∫—Ü–∏–∏
SELECT * FROM get_services_for_promotion(123);
```

### –ß–µ—Ä–µ–∑ Frontend:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ú–æ–∏ –º–∞—Å—Ç–µ—Ä–∞" (Services)
3. –ù–∞–π–¥–∏—Ç–µ —É—Å–ª—É–≥—É, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π —Å–æ–∑–¥–∞–Ω–∞ –∞–∫—Ü–∏—è
4. –û—Ç–∫—Ä–æ–π—Ç–µ —É—Å–ª—É–≥—É
5. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ "üéÅ –û–±–º–µ–Ω—è—Ç—å –ø–æ –∞–∫—Ü–∏–∏: [–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ü–∏–∏]"

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –ü—Ä—è–º–æ–π –æ–±–º–µ–Ω –±–∞–ª–ª–æ–≤ –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

- ‚ùå –ö–Ω–æ–ø–∫–∞ "üí∏ –û–±–º–µ–Ω—è—Ç—å X –±–∞–ª–ª–æ–≤" **–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è** –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —É—Å–ª—É–≥
- ‚úÖ –û–±–º–µ–Ω –≤–æ–∑–º–æ–∂–µ–Ω **–¢–û–õ–¨–ö–û** —á–µ—Ä–µ–∑ –∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ `points_redemption`
- ‚úÖ Endpoint `/api/redeem` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ DEPRECATED –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

### 2. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∞–∫—Ü–∏–π —Ç–∏–ø–∞ `points_redemption`

- `service_ids` - —Å–ø–∏—Å–æ–∫ UUID —É—Å–ª—É–≥ (–º–∏–Ω–∏–º—É–º 1)
- `service_price` - —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö
- `max_points_payment` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –±–∞–ª–ª–∞–º–∏ –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö
- `points_to_dollar_rate` - –∫—É—Ä—Å –æ–±–º–µ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.0)

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è

- –£—Å–ª—É–≥–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä—É
- –£—Å–ª—É–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–æ–±—Ä–µ–Ω—ã (`approval_status = 'Approved'`)
- –£—Å–ª—É–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–∫—Ç–∏–≤–Ω—ã (`is_active = true`)
- `max_points_payment` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ `service_price`

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ü–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ –∞–∫—Ü–∏—é —Ç–∏–ø–∞ `points_redemption`
2. –í—ã–±–µ—Ä–∏—Ç–µ 2-3 —É—Å–ª—É–≥–∏
3. –£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø–ª–∞—Ç—ã –±–∞–ª–ª–∞–º–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î, —á—Ç–æ —Å–≤—è–∑–∏ —Å–æ–∑–¥–∞–Ω—ã:
   ```sql
   SELECT * FROM promotion_services WHERE promotion_id = [ID_–ê–ö–¶–ò–ò];
   ```

### –¢–µ—Å—Ç 2: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–∫—Ü–∏–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ —É—Å–ª—É–≥—É, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π —Å–æ–∑–¥–∞–Ω–∞ –∞–∫—Ü–∏—è
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "üéÅ –û–±–º–µ–Ω—è—Ç—å –ø–æ –∞–∫—Ü–∏–∏"
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
4. –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–∫—Ü–∏–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ–ø–ª–∞—Ç—ã –±–∞–ª–ª–∞–º–∏

### –¢–µ—Å—Ç 3: –û–±–º–µ–Ω –±–∞–ª–ª–æ–≤ —á–µ—Ä–µ–∑ –∞–∫—Ü–∏—é

1. –í—ã–±–µ—Ä–∏—Ç–µ –∞–∫—Ü–∏—é –¥–ª—è —É—Å–ª—É–≥–∏
2. –í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å—á–µ—Ç –¥–æ–ø–ª–∞—Ç—ã –Ω–∞–ª–∏—á–Ω—ã–º–∏
4. –ü–æ–ª—É—á–∏—Ç–µ QR-–∫–æ–¥
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞ –º–∞—Å—Ç–µ—Ä–æ–º

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `promotions` (–æ–±–Ω–æ–≤–ª–µ–Ω–∞):
```sql
- promotion_type: 'discount' | 'points_redemption' | 'cashback'
- service_price: NUMERIC (–¥–ª—è points_redemption)
- max_points_payment: NUMERIC (–¥–ª—è points_redemption)
- points_to_dollar_rate: NUMERIC (–¥–ª—è points_redemption)
```

### –¢–∞–±–ª–∏—Ü–∞ `promotion_services` (–Ω–æ–≤–∞—è):
```sql
- promotion_id: INTEGER ‚Üí promotions(id)
- service_id: UUID ‚Üí services(id)
- UNIQUE(promotion_id, service_id)
```

---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "–£ –≤–∞—Å –Ω–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö —É—Å–ª—É–≥"
**–†–µ—à–µ–Ω–∏–µ:** –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —É—Å–ª—É–≥–∏ –∏ –ø–æ–ª—É—á–∏—Ç–µ –∏—Ö –æ–¥–æ–±—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–±–æ—Ç–∞.

### –ü—Ä–æ–±–ª–µ–º–∞: –ê–∫—Ü–∏—è –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è —É—Å–ª—É–≥–∏
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –ê–∫—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞ (`is_active = true`)
2. –ê–∫—Ü–∏—è –Ω–µ –∏—Å—Ç–µ–∫–ª–∞ (`end_date >= —Å–µ–≥–æ–¥–Ω—è`)
3. –ê–∫—Ü–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —É—Å–ª—É–≥–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `promotion_services`
4. –¢–∏–ø –∞–∫—Ü–∏–∏: `points_redemption`

### –ü—Ä–æ–±–ª–µ–º–∞: "–ü—Ä—è–º–æ–π –æ–±–º–µ–Ω –±–∞–ª–ª–æ–≤ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"
**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** –¢–µ–ø–µ—Ä—å –æ–±–º–µ–Ω –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∞–∫—Ü–∏–∏. –ù–∞–π–¥–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω—É—é –∞–∫—Ü–∏—é –¥–ª—è —É—Å–ª—É–≥–∏.

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] SQL –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- [ ] –ü–æ–ª–µ `promotion_type` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `promotions`
- [ ] –¢–∞–±–ª–∏—Ü–∞ `promotion_services` —Å–æ–∑–¥–∞–Ω–∞
- [ ] –§—É–Ω–∫—Ü–∏–∏ –ë–î —Å–æ–∑–¥–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –±–æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] Frontend –æ–±–Ω–æ–≤–ª–µ–Ω (—É–±—Ä–∞–Ω–∞ –ø—Ä—è–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–º–µ–Ω–∞)
- [ ] API endpoint `/api/redeem` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ deprecated
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ü–∏–∏ —Å —É—Å–ª—É–≥–∞–º–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–∫—Ü–∏–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –æ–±–º–µ–Ω –±–∞–ª–ª–æ–≤ —á–µ—Ä–µ–∑ –∞–∫—Ü–∏—é

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ
