# üöÄ MLM –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å Revenue Share - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

**–î–∞—Ç–∞:** –ù–æ—è–±—Ä—å 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
- [–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏](#—É—Å–ª–æ–≤–∏—è-–∞–∫—Ç–∏–≤–∞—Ü–∏–∏)
- [–†–∞—Å—á–µ—Ç Revenue Share](#—Ä–∞—Å—á–µ—Ç-revenue-share)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [–ü—Ä–∏–º–µ—Ä—ã](#–ø—Ä–∏–º–µ—Ä—ã)

---

## üéØ –û–±–∑–æ—Ä

MLM –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å Revenue Share –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º –ø–æ–ª—É—á–∞—Ç—å –¥–æ—Ö–æ–¥ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏, —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º 30% –æ—Ç –ª–∏—á–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- ‚úÖ 3 —É—Ä–æ–≤–Ω—è Revenue Share (5% –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 30% –æ—Ç –ª–∏—á–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
- ‚úÖ –£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (–º–∏–Ω–∏–º—É–º $500/–º–µ—Å, 20+ –∫–ª–∏–µ–Ω—Ç–æ–≤)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º FTC

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

#### 1. `partners` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã)

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:
- `partner_type` - –¢–∏–ø –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (regular, partner, regional, master)
- `partner_level` - –£—Ä–æ–≤–µ–Ω—å –≤ —Å–µ—Ç–∏ (0-3)
- `referred_by_chat_id` - –ö—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª
- `personal_income_monthly` - –õ–∏—á–Ω—ã–π –¥–æ—Ö–æ–¥ ($/–º–µ—Å)
- `client_base_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
- `revenue_share_monthly` - Revenue Share –∑–∞ –º–µ—Å—è—Ü
- `is_revenue_share_active` - –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ Revenue Share

#### 2. `partner_network`

–°–≤—è–∑–∏ –º–µ–∂–¥—É –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏:
- `referrer_chat_id` - –ö—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª
- `referred_chat_id` - –ö–æ–≥–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏
- `level` - –£—Ä–æ–≤–µ–Ω—å (1-3)
- `client_base_shared` - –î–µ–ª–∏—Ç—Å—è –ª–∏ –±–∞–∑–∞

#### 3. `partner_revenue_share`

–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–ª–∞—Ç Revenue Share:
- `partner_chat_id` - –ö—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç
- `source_partner_chat_id` - –° –∫–æ–≥–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
- `level` - –£—Ä–æ–≤–µ–Ω—å (1-3)
- `system_revenue` - –î–æ—Ö–æ–¥ —Å–∏—Å—Ç–µ–º—ã
- `calculated_amount` - –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Å—É–º–º–∞
- `final_amount` - –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ (—Å —É—á–µ—Ç–æ–º –ª–∏–º–∏—Ç–∞ 30%)
- `status` - –°—Ç–∞—Ç—É—Å (pending, approved, paid, cancelled)

#### 4. `partner_recruitment_commissions`

–ö–æ–º–∏—Å—Å–∏–∏ –∑–∞ —Ä–µ–∫—Ä—É—Ç–∏–Ω–≥:
- `referrer_chat_id` - –ö—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª
- `referred_chat_id` - –ö–æ–≥–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏
- `level` - –£—Ä–æ–≤–µ–Ω—å (1-2)
- `commission_amount` - –°—É–º–º–∞ –∫–æ–º–∏—Å—Å–∏–∏

#### 5. `partner_activation_conditions`

–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Revenue Share:
- `partner_chat_id` - –ü–∞—Ä—Ç–Ω–µ—Ä
- `uses_product` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–¥—É–∫—Ç
- `client_base_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
- `personal_income_monthly` - –õ–∏—á–Ω—ã–π –¥–æ—Ö–æ–¥
- `meets_all_conditions` - –í—ã–ø–æ–ª–Ω–µ–Ω—ã –ª–∏ –≤—Å–µ —É—Å–ª–æ–≤–∏—è

---

## ‚úÖ –£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Revenue Share –ø–∞—Ä—Ç–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å **–≤—Å–µ** —É—Å–ª–æ–≤–∏—è:

1. **–õ–∏—á–Ω—ã–π –¥–æ—Ö–æ–¥ >= $500/–º–µ—Å**
   - –î–æ—Ö–æ–¥ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

2. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –±–∞–∑–∞ >= 20 –∫–ª–∏–µ–Ω—Ç–æ–≤**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

3. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–¥—É–∫—Ç**
   - `personal_income_monthly > 0`
   - –ï—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π

```python
from partner_revenue_share import PartnerRevenueShare
from supabase_manager import SupabaseManager

db = SupabaseManager()
revenue_share = PartnerRevenueShare(db)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
is_active = revenue_share.check_activation_conditions("partner_chat_id")
```

---

## üí∞ –†–∞—Å—á–µ—Ç Revenue Share

### –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è PV (Partner Value)

**PV** - —ç—Ç–æ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –¥–æ—Ö–æ–¥–æ–≤ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞. 
PV –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Ç—Ä–∞—Å–ª–∏.

#### –ü—Ä–∏–º–µ—Ä—ã PV –ø–æ –æ—Ç—Ä–∞—Å–ª—è–º:

- **–ö–∞—Ñ–µ/–†–µ—Å—Ç–æ—Ä–∞–Ω—ã**: 5-7%
- **–°–∞–ª–æ–Ω—ã –∫—Ä–∞—Å–æ—Ç—ã**: 8-10%
- **–§–∏—Ç–Ω–µ—Å-–∫–ª—É–±—ã**: 6-8%
- **–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ü–µ–Ω—Ç—Ä—ã**: 10-12%
- **–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å—ã**: 7-9%

### –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞

```
1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–æ—Ö–æ–¥ —Å–∏—Å—Ç–µ–º—ã: partner_turnover √ó PV%
2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º Revenue Share: system_revenue √ó 5%
3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ª–∏–º–∏—Ç: personal_income √ó 30%
4. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: min(revenue_share, limit)
```

### –ü—Ä–∏–º–µ—Ä

```
–ü–∞—Ä—Ç–Ω–µ—Ä –ë (—Å–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã):
‚îú‚îÄ –û–±–æ—Ä–æ—Ç —Å –∫–ª–∏–µ–Ω—Ç–æ–≤: $20,000/–º–µ—Å
‚îú‚îÄ PV: 10% (–¥–ª—è —Å–∞–ª–æ–Ω–æ–≤)
‚îú‚îÄ –î–æ—Ö–æ–¥ —Å–∏—Å—Ç–µ–º—ã: $20,000 √ó 10% = $2,000/–º–µ—Å

–ü–∞—Ä—Ç–Ω–µ—Ä –ê (–ø–æ–ª—É—á–∞–µ—Ç Revenue Share):
‚îú‚îÄ –õ–∏—á–Ω—ã–π –¥–æ—Ö–æ–¥: $1,000/–º–µ—Å
‚îú‚îÄ –î–æ—Ö–æ–¥ —Å–∏—Å—Ç–µ–º—ã —Å –ü–∞—Ä—Ç–Ω–µ—Ä–∞ –ë: $2,000/–º–µ—Å
‚îú‚îÄ Revenue Share (5%): $2,000 √ó 5% = $100
‚îú‚îÄ –õ–∏–º–∏—Ç (30%): $1,000 √ó 30% = $300
‚îî‚îÄ –ò—Ç–æ–≥–æ–≤–∞—è –≤—ã–ø–ª–∞—Ç–∞: min($100, $300) = $100 ‚úÖ
```

### –†–∞—Å—á–µ—Ç –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```
–£—Ä–æ–≤–µ–Ω—å 1 (–†–µ—Ñ–µ—Ä–µ—Ä):
‚îú‚îÄ –° –∫–∞–∂–¥–æ–≥–æ –ü–∞—Ä—Ç–Ω–µ—Ä–∞ –ë: $2,000 √ó 5% = $100
‚îú‚îÄ –í—Å–µ–≥–æ –ü–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –ë: 100
‚îú‚îÄ –†–∞—Å—á–µ—Ç–Ω–∞—è —Å—É–º–º–∞: $10,000
‚îú‚îÄ –õ–∏–º–∏—Ç: $1,000 √ó 30% = $300
‚îî‚îÄ –í—ã–ø–ª–∞—Ç–∞: $300 (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ)

–£—Ä–æ–≤–µ–Ω—å 2 (–ü–∞—Ä—Ç–Ω–µ—Ä –ê):
‚îú‚îÄ –° –∫–∞–∂–¥–æ–≥–æ –ü–∞—Ä—Ç–Ω–µ—Ä–∞ –ë: $2,000 √ó 5% = $100
‚îú‚îÄ –í—Å–µ–≥–æ –ü–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –ë: 10
‚îú‚îÄ –†–∞—Å—á–µ—Ç–Ω–∞—è —Å—É–º–º–∞: $1,000
‚îú‚îÄ –õ–∏–º–∏—Ç: $1,000 √ó 30% = $300
‚îî‚îÄ –í—ã–ø–ª–∞—Ç–∞: $300 (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ)

–£—Ä–æ–≤–µ–Ω—å 3 (–ü–∞—Ä—Ç–Ω–µ—Ä –ë):
‚îú‚îÄ –° —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–±–æ—Ä–æ—Ç–∞: $2,000 √ó 5% = $100
‚îú‚îÄ –õ–∏–º–∏—Ç: $1,000 √ó 30% = $300
‚îî‚îÄ –í—ã–ø–ª–∞—Ç–∞: $100 (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞)
```

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SQL –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase SQL Editor
psql -f supabase_mlm_partner_revenue_share.sql
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Supabase Dashboard:
1. –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `supabase_mlm_partner_revenue_share.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å

### 2. –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è

```python
from partner_revenue_share import PartnerRevenueShare
from supabase_manager import SupabaseManager

db = SupabaseManager()
revenue_share = PartnerRevenueShare(db)
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PV –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞

```python
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PV –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
revenue_share.set_partner_pv(
    partner_chat_id="123456789",
    pv_percent=8.0,  # 8% –¥–ª—è —Å–∞–ª–æ–Ω–∞ –∫—Ä–∞—Å–æ—Ç—ã
    industry_type="salon"
)

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PV –¥–ª—è –≤—Å–µ–π –æ—Ç—Ä–∞—Å–ª–∏
revenue_share.set_industry_pv(
    industry_type="cafe",
    pv_percent=5.0  # 5% –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ñ–µ
)

# –ü–æ–ª—É—á–µ–Ω–∏–µ PV –ø–∞—Ä—Ç–Ω–µ—Ä–∞
pv = revenue_share.get_partner_pv("123456789")
print(f"PV –ø–∞—Ä—Ç–Ω–µ—Ä–∞: {pv}%")
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º PV)

```python
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
# PV –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Ö–æ–¥–∞
revenue_share.update_partner_income_and_clients(
    partner_chat_id="123456789",
    personal_income=1000.0,  # $1,000/–º–µ—Å ‚Üí PV –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ = 5%
    client_count=50,  # 50 –∫–ª–∏–µ–Ω—Ç–æ–≤
    auto_update_pv=True  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é True
)

# –ü—Ä–∏ —Ä–æ—Å—Ç–µ –¥–æ—Ö–æ–¥–∞ PV —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# $600/–º–µ—Å ‚Üí PV = 3%
# $1,200/–º–µ—Å ‚Üí PV = 5%
# $2,500/–º–µ—Å ‚Üí PV = 7%
# $5,500/–º–µ—Å ‚Üí PV = 10%
```

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ Revenue Share –∑–∞ –ø–µ—Ä–∏–æ–¥

```python
from datetime import date

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
period_start = date.today().replace(day=1)
period_end = date.today()

stats = revenue_share.process_revenue_share_for_period(
    period_start=period_start,
    period_end=period_end
)

print(f"–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {stats['total_processed']}")
print(f"–û–±—â–∞—è —Å—É–º–º–∞: ${stats['total_amount']}")
```

### 6. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –ø–æ –ø–∞—Ä—Ç–Ω–µ—Ä—É

```python
summary = revenue_share.get_partner_revenue_share_summary(
    partner_chat_id="123456789"
)

print(f"–õ–∏—á–Ω—ã–π –¥–æ—Ö–æ–¥: ${summary['personal_income']}")
print(f"Revenue Share –∑–∞ –º–µ—Å—è—Ü: ${summary['revenue_share_monthly']}")
print(f"–õ–∏–º–∏—Ç 30%: ${summary['limit_30_percent']}")
print(f"–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: {summary['usage_percent']}% / {summary['revenue_share_percent']}%")
```

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ PV

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç PV –ø—Ä–∏ —Ä–æ—Å—Ç–µ –ª–∏—á–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞:

```
–õ–∏—á–Ω—ã–π –¥–æ—Ö–æ–¥ ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π PV
‚îú‚îÄ $0-999/–º–µ—Å        ‚Üí PV = 3%  (–ù–æ–≤–∏—á–æ–∫)
‚îú‚îÄ $1,000-1,999/–º–µ—Å  ‚Üí PV = 5%  (–ê–∫—Ç–∏–≤–Ω—ã–π)
‚îú‚îÄ $2,000-4,999/–º–µ—Å  ‚Üí PV = 7%  (–†–∞—Å—Ç—É—â–∏–π)
‚îî‚îÄ $5,000+/–º–µ—Å       ‚Üí PV = 10% (–ü—Ä–µ–º–∏—É–º)
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. `AUTO_PV_UPDATE_GUIDE.md`

---

## üìä –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞

```python
# 1. –ü–∞—Ä—Ç–Ω–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∏ –ø–æ–∫—É–ø–∞–µ—Ç –ø–∞–∫–µ—Ç
partner_chat_id = "123456789"
referrer_chat_id = "987654321"  # –ö—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª

# 2. –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ—Ç—å
db.client.table('partner_network').insert({
    'referrer_chat_id': referrer_chat_id,
    'referred_chat_id': partner_chat_id,
    'level': 1,
    'is_active': True
}).execute()

# 3. –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
db.client.table('partners').update({
    'partner_type': 'partner',
    'referred_by_chat_id': referrer_chat_id,
    'partner_package_purchased_at': datetime.now().isoformat()
}).eq('chat_id', partner_chat_id).execute()
```

### –ü—Ä–∏–º–µ—Ä 2: –ê–∫—Ç–∏–≤–∞—Ü–∏—è Revenue Share

```python
# 1. –ü–∞—Ä—Ç–Ω–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
revenue_share.update_partner_income_and_clients(
    partner_chat_id="123456789",
    personal_income=600.0,  # $600/–º–µ—Å (>= $500)
    client_count=25  # 25 –∫–ª–∏–µ–Ω—Ç–æ–≤ (>= 20)
)

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–∞—Ü–∏—é
is_active = revenue_share.check_activation_conditions("123456789")
# –í–µ—Ä–Ω–µ—Ç True, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ —É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
```

### –ü—Ä–∏–º–µ—Ä 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PV

```python
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PV –¥–ª—è —Å–∞–ª–æ–Ω–∞ –∫—Ä–∞—Å–æ—Ç—ã
revenue_share.set_partner_pv(
    partner_chat_id="salon_partner_id",
    pv_percent=10.0,  # 10% –¥–ª—è —Å–∞–ª–æ–Ω–æ–≤
    industry_type="salon"
)

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PV –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ñ–µ
revenue_share.set_industry_pv(
    industry_type="cafe",
    pv_percent=5.0  # 5% –¥–ª—è –∫–∞—Ñ–µ
)
```

### –ü—Ä–∏–º–µ—Ä 4: –†–∞—Å—á–µ—Ç Revenue Share —Å PV

```python
# –ü–∞—Ä—Ç–Ω–µ—Ä –ë (—Å–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã):
# - –û–±–æ—Ä–æ—Ç: $20,000/–º–µ—Å
# - PV: 10%
# - –î–æ—Ö–æ–¥ —Å–∏—Å—Ç–µ–º—ã: $20,000 √ó 10% = $2,000/–º–µ—Å

# –î–ª—è –ü–∞—Ä—Ç–Ω–µ—Ä–∞ –ê (—É—Ä–æ–≤–µ–Ω—å 2)
calculation = revenue_share.calculate_revenue_share(
    partner_chat_id="partner_a_id",
    source_partner_chat_id="partner_b_id",
    system_revenue=2000.0,  # –£–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ —Å —É—á–µ—Ç–æ–º PV
    level=2
)

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# {
#     'calculated_amount': 100.0,  # $2,000 √ó 5% = $100
#     'personal_income_limit': 300.0,  # $1,000 √ó 30% = $300
#     'final_amount': 100.0  # min($100, $300) = $100
# }
```

### –ü—Ä–∏–º–µ—Ä 5: –ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
from datetime import date, timedelta

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü
today = date.today()
first_day = today.replace(day=1)
last_month_end = first_day - timedelta(days=1)
last_month_start = last_month_end.replace(day=1)

stats = revenue_share.process_revenue_share_for_period(
    period_start=last_month_start,
    period_end=last_month_end
)

# –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –æ–¥–æ–±—Ä–∏—Ç—å –≤—ã–ø–ª–∞—Ç—ã
pending_payments = db.client.table('partner_revenue_share').select(
    '*'
).eq('status', 'pending').gte(
    'period_start', last_month_start.isoformat()
).lte('period_end', last_month_end.isoformat()).execute()

for payment in pending_payments.data:
    # –û–¥–æ–±—Ä—è–µ–º –≤—ã–ø–ª–∞—Ç—É
    db.client.table('partner_revenue_share').update({
        'status': 'approved'
    }).eq('id', payment['id']).execute()
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ FTC

### –ì–∞—Ä–∞–Ω—Ç–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 30%**
   - Revenue Share –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 30% –æ—Ç –ª–∏—á–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ

2. **–£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**
   - –ü–∞—Ä—Ç–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç ($500+/–º–µ—Å)
   - –ü–∞—Ä—Ç–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ (20+)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π

3. **–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤**
   - –û—Å–Ω–æ–≤–Ω–æ–π –¥–æ—Ö–æ–¥ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: 70%+
   - Revenue Share: 30% (–º–∞–∫—Å–∏–º—É–º)
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º FTC

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:

```python
summary = revenue_share.get_partner_revenue_share_summary("partner_id")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ
if summary['usage_percent'] >= 70.0:
    print("‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç FTC (70%+ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)")
else:
    print("‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞")
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `partner_statistics`

```sql
SELECT * FROM partner_statistics
WHERE partner_chat_id = '123456789';
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –õ–∏—á–Ω—ã–π –¥–æ—Ö–æ–¥
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
- Revenue Share –∑–∞ –º–µ—Å—è—Ü
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- –†–∞–∑–º–µ—Ä —Å–µ—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤**
2. **–û–±—â–∞—è —Å—É–º–º–∞ Revenue Share –≤—ã–ø–ª–∞—Ç**
3. **–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ / Revenue Share)**
4. **–ü—Ä–æ—Ü–µ–Ω—Ç –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ —Å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º Revenue Share**

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- –†–∞—Å—á–µ—Ç Revenue Share
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–∏–æ–¥–æ–≤
- –û—à–∏–±–∫–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:
- `check_activation_conditions()` ‚Üí `False`
- `calculate_revenue_share()` ‚Üí `{'final_amount': 0.0}`
- `process_revenue_share_for_period()` ‚Üí `{'errors': [...]}`

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é `supabase_mlm_partner_revenue_share.sql`
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å `partner_revenue_share.py`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–∂–µ–º–µ—Å—è—á–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É Revenue Share
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –∫–æ–º–∞–Ω–¥—ã

---

**–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** –ù–æ—è–±—Ä—å 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

