# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ Cloudflare - –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°

## ‚úÖ –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Wrangler

–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
wrangler --version
```

**–ï—Å–ª–∏ Wrangler –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ:

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: —á–µ—Ä–µ–∑ npm
npm install -g wrangler

# –í–∞—Ä–∏–∞–Ω—Ç 2: —á–µ—Ä–µ–∑ Homebrew (macOS)
brew install cloudflare-wrangler
```

---

## ‚úÖ –®–ê–ì 2: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Wrangler

```bash
wrangler login
```

–≠—Ç–æ –æ—Ç–∫—Ä–æ–µ—Ç –±—Ä–∞—É–∑–µ—Ä ‚Äî –Ω–∞–∂–º–∏—Ç–µ "Allow" –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
```bash
wrangler whoami
```

–î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –≤–∞—à email.

---

## ‚úÖ –®–ê–ì 3: –î–µ–ø–ª–æ–π –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –±–æ—Ç–∞

```bash
cd /Users/ghbi/Downloads/loyalitybot/cloudflare/workers/client-webhook
wrangler deploy
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
1. Wrangler —Å–æ–±–µ—Ä–µ—Ç worker
2. –ó–∞–≥—Ä—É–∑–∏—Ç –µ–≥–æ –≤ Cloudflare
3. –ü–æ–∫–∞–∂–µ—Ç URL –≤–∞—à–µ–≥–æ worker (–ø—Ä–∏–º–µ—Ä–Ω–æ: `https://loyalitybot-client-webhook.aerasun3000.workers.dev`)

**–í–ê–ñ–ù–û:** –ó–∞–ø–∏—à–∏—Ç–µ —ç—Ç–æ—Ç URL! –û–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook.

---

## ‚úÖ –®–ê–ì 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã (–∑–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å–≤–æ–∏ –∏–∑ `.env`):

```bash
# –¢–æ–∫–µ–Ω –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –±–æ—Ç–∞
wrangler secret put TOKEN_CLIENT
# –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–Ω–∞—á–Ω–µ—Ç—Å—è —Å —Ü–∏—Ñ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä: 123456789:ABC...)

# Supabase URL
wrangler secret put SUPABASE_URL
# –í–≤–µ–¥–∏—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://xxxxx.supabase.co)

# Supabase Key
wrangler secret put SUPABASE_KEY
# –í–≤–µ–¥–∏—Ç–µ anon key –∏–∑ Supabase

# Frontend URL
wrangler secret put FRONTEND_URL
# –í–≤–µ–¥–∏—Ç–µ URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://loyalitybot.netlify.app)

# Welcome bonus
wrangler secret put WELCOME_BONUS_AMOUNT
# –í–≤–µ–¥–∏—Ç–µ: 100
```

**–ì–¥–µ –Ω–∞–π—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è:**
- `TOKEN_CLIENT` - –∏–∑ `.env` —Ñ–∞–π–ª–∞ (–∏–ª–∏ —É @BotFather –≤ Telegram)
- `SUPABASE_URL` - –∏–∑ `.env` —Ñ–∞–π–ª–∞ –∏–ª–∏ Supabase Dashboard ‚Üí Settings ‚Üí API
- `SUPABASE_KEY` - –∏–∑ `.env` —Ñ–∞–π–ª–∞ –∏–ª–∏ Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí anon/public key
- `FRONTEND_URL` - –≤–∞—à —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ Netlify

---

## ‚úÖ –®–ê–ì 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤, –¥–æ–±–∞–≤—å—Ç–µ URL –≤ `.env`:

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª
nano .env
# –∏–ª–∏
code .env

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
CLOUDFLARE_CLIENT_WEBHOOK_URL=https://–≤–∞—à-worker-url.workers.dev
```

**–ó–∞—Ç–µ–º –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ webhook —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:**

```bash
cd /Users/ghbi/Downloads/loyalitybot
python3 scripts/setup_webhooks.py
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ curl:**

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ <TOKEN_CLIENT> –∏ <WORKER_URL> –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
curl -X POST "https://api.telegram.org/bot<TOKEN_CLIENT>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://–≤–∞—à-worker-url.workers.dev"}'
```

---

## ‚úÖ –®–ê–ì 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Cloudflare Dashboard ‚Üí Workers & Pages ‚Üí –≤–∞—à–µ–≥–æ worker ‚Üí Logs

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

1. **–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ä—ã–π –±–æ—Ç** –Ω–∞ Fly.io –¥–æ –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
2. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π URL** webhook (–µ—Å–ª–∏ –±—ã–ª)
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏** –≤ Cloudflare Dashboard –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

---

## üìû –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –±–æ—Ç–∞:

1. **–°–æ–æ–±—â–∏—Ç–µ –º–Ω–µ** - —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ
2. –Ø —Å–æ–∑–¥–∞–º handlers –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–≥–æ –±–æ—Ç–∞
3. –Ø —Å–æ–∑–¥–∞–º handlers –¥–ª—è –∞–¥–º–∏–Ω-–±–æ—Ç–∞
4. –ü–µ—Ä–µ–≤–µ–¥–µ–º –≤—Å–µ –±–æ—Ç—ã –Ω–∞ webhooks

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
```bash
wrangler login
```

**–û—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Ñ–∞–π–ª–æ–≤ (–º–æ–≥—É –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

**–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Cloudflare Dashboard
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ù–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ –æ –ª—é–±–æ–π –ø—Ä–æ–±–ª–µ–º–µ - –ø–æ–º–æ–≥—É —Ä–µ—à–∏—Ç—å!**
