# –ü–æ—à–∞–≥–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π

## üìã –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –≥–∏–±—Ä–∏–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ —Å 3 —É—Ä–æ–≤–Ω—è–º–∏:
- **–£—Ä–æ–≤–µ–Ω—å 1**: –ü—Ä—è–º–æ–π —Ä–µ—Ñ–µ—Ä–∞–ª (—Ç–æ—Ç, –∫–æ–≥–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é)
- **–£—Ä–æ–≤–µ–Ω—å 2**: –†–µ—Ñ–µ—Ä–∞–ª —Ä–µ—Ñ–µ—Ä–∞–ª–∞ (–≤–Ω—É—á–∞—Ç—ã–π)
- **–£—Ä–æ–≤–µ–Ω—å 3**: –†–µ—Ñ–µ—Ä–∞–ª —Ä–µ—Ñ–µ—Ä–∞–ª–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ (–ø—Ä–∞–≤–Ω—É—á–∞—Ç—ã–π)

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ–Ω—É—Å–æ–≤

**–ë–æ–Ω—É—Å—ã –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é:**
- –£—Ä–æ–≤–µ–Ω—å 1: 100 –±–∞–ª–ª–æ–≤
- –£—Ä–æ–≤–µ–Ω—å 2: 25 –±–∞–ª–ª–æ–≤
- –£—Ä–æ–≤–µ–Ω—å 3: 10 –±–∞–ª–ª–æ–≤

**–ü—Ä–æ—Ü–µ–Ω—Ç —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
- –£—Ä–æ–≤–µ–Ω—å 1: 8% –æ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤
- –£—Ä–æ–≤–µ–Ω—å 2: 4% –æ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤
- –£—Ä–æ–≤–µ–Ω—å 3: 2% –æ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤

---

## üîó –≠—Ç–∞–ø 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏

### –®–∞–≥ 1.1: –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É

**–¢—Ä–∏–≥–≥–µ—Ä:**
- –ö–æ–º–∞–Ω–¥–∞ `/referral`, `/—Ä–µ—Ñ–µ—Ä–∞–ª—ã`, `/–ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å` –≤ –±–æ—Ç–µ
- –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–°–æ–æ–±—â–µ—Å—Ç–≤–æ" –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `sm.get_or_create_referral_code(chat_id)`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –≤ —Ç–∞–±–ª–∏—Ü–µ `users.referral_code`
3. –ï—Å–ª–∏ –∫–æ–¥–∞ –Ω–µ—Ç:
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π 6-—Å–∏–º–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ —á–µ—Ä–µ–∑ `generate_referral_code(chat_id)`
   - –§–æ—Ä–º—É–ª–∞: `UPPER(MD5(chat_id + timestamp)[:6])`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ –ë–î
   - –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ —É–Ω–∏–∫–∞–ª–µ–Ω, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π
   - –ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `users.referral_code`
4. –ï—Å–ª–∏ –∫–æ–¥ –µ—Å—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥: –Ω–∞–ø—Ä–∏–º–µ—Ä, `ABC123`

### –®–∞–≥ 1.2: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏

**–§–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏:**
```
https://t.me/{bot_username}?start=ref_{referral_code}
```

**–ü—Ä–∏–º–µ—Ä:**
```
https://t.me/mindbeatybot?start=ref_ABC123
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –í –±–æ—Ç–µ: –∫–æ–º–∞–Ω–¥–∞ `/referral` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É —Å –∫–Ω–æ–ø–∫–æ–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- –í–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ "–°–æ–æ–±—â–µ—Å—Ç–≤–æ" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ QR-–∫–æ–¥–æ–º

---

## üë§ –≠—Ç–∞–ø 2: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ

### –®–∞–≥ 2.1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ —Å—Å—ã–ª–∫—É

**–î–µ–π—Å—Ç–≤–∏–µ:**
- Telegram –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `/start ref_ABC123`
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handle_new_user_start(message)` –≤ `client_handler.py`

### –®–∞–≥ 2.2: –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏

**–ö–æ–¥:**
```python
# –í client_handler.py, —Å—Ç—Ä–æ–∫–∏ 687-699
CLIENT_REFERRAL_PATTERN = re.compile(r'ref_([A-Z0-9]{6})', re.IGNORECASE)
client_match = CLIENT_REFERRAL_PATTERN.search(text)

if client_match:
    client_referral_code = client_match.group(1).upper()
    logger.info(f"–û–±–Ω–∞—Ä—É–∂–µ–Ω —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞: {client_referral_code}")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ò–∑–≤–ª–µ—á—ë–Ω –∫–æ–¥ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞: `ABC123`
- –ü–µ—Ä–µ–≤–µ–¥—ë–Ω –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä –¥–ª—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## ‚úÖ –≠—Ç–∞–ø 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –®–∞–≥ 3.1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–î–µ–π—Å—Ç–≤–∏–µ:**
```python
client_exists = sm.client_exists(chat_id)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ï—Å–ª–∏ `True`: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –ø–µ—Ä–µ—Ö–æ–¥ –∫ —ç—Ç–∞–ø—É "–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª–∏–µ–Ω—Ç"
- –ï—Å–ª–∏ `False`: –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

### –®–∞–≥ 3.2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ

**–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥:**
```python
result = sm.register_client_via_client_referral(chat_id, client_referral_code, phone=None, name=None)
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –º–µ—Ç–æ–¥–∞ `register_client_via_client_referral`:**

#### 3.2.1: –ü–æ–∏—Å–∫ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ –ø–æ –∫–æ–¥—É
```python
referrer_data = self.client.from_(USER_TABLE)
    .select('chat_id')
    .eq('referral_code', referrer_code.upper())
    .limit(1)
    .execute()

referrer_chat_id = referrer_data.data[0]['chat_id']
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
- ‚úÖ –†–µ—Ñ–µ—Ä–µ—Ä –Ω–∞–π–¥–µ–Ω –ø–æ –∫–æ–¥—É
- ‚ùå –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ "–ù–µ–≤–µ—Ä–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥"

#### 3.2.2: –í–∞–ª–∏–¥–∞—Ü–∏—è
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∞–º–æ—Ä–µ—Ñ–µ—Ä–∞—Ü–∏—é
if str(chat_id) == str(referrer_chat_id):
    return None, "–ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
if self.client_exists(int(chat_id)):
    return None, "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"
```

#### 3.2.3: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
client_data = {
    'chat_id': str(chat_id),
    'phone': phone,  # None –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ
    'name': name,    # None –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ
    'status': 'active',
    'balance': 100,  # WELCOME_BONUS_AMOUNT
    'registered_via': 'client_referral',
    'referred_by_chat_id': referrer_chat_id,  # –í–∞–∂–Ω–æ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞
    'reg_date': datetime.datetime.now().isoformat()
}

self.client.from_(USER_TABLE).insert(client_data).execute()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- –ë–∞–ª–∞–Ω—Å: 100 –±–∞–ª–ª–æ–≤ (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å)
- –°–≤—è–∑—å —Å —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ `referred_by_chat_id`

---

## üå≥ –≠—Ç–∞–ø 4: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

### –®–∞–≥ 4.1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–î–µ–π—Å—Ç–≤–∏–µ:**
```python
self.get_or_create_referral_code(str(chat_id))
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
- –ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `users.referral_code`

### –®–∞–≥ 4.2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –≤ referral_tree

**–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥:**
```python
self._create_referral_tree_links(str(chat_id), referrer_chat_id)
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:**

#### 4.2.1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ —É—Ä–æ–≤–Ω—è 1 (–ø—Ä—è–º–æ–π —Ä–µ—Ñ–µ—Ä–µ—Ä)
```python
tree_data_1 = {
    'referrer_chat_id': direct_referrer_chat_id,  # –¢–æ—Ç, –∫—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª
    'referred_chat_id': new_user_chat_id,         # –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    'level': 1,
    'is_active': True
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç
existing = self.client.from_('referral_tree')
    .select('id')
    .eq('referrer_chat_id', direct_referrer_chat_id)
    .eq('referred_chat_id', new_user_chat_id)
    .limit(1)
    .execute()

if not existing.data:
    self.client.from_('referral_tree').insert(tree_data_1).execute()
```

#### 4.2.2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ —É—Ä–æ–≤–Ω—è 2 (—Ä–µ—Ñ–µ—Ä–µ—Ä —Ä–µ—Ñ–µ—Ä–µ—Ä–∞)
```python
# –ù–∞—Ö–æ–¥–∏–º, –∫—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ —É—Ä–æ–≤–Ω—è 1
referrer_2_data = self.client.from_(USER_TABLE)
    .select('referred_by_chat_id')
    .eq('chat_id', direct_referrer_chat_id)
    .limit(1)
    .execute()

if referrer_2_data.data and referrer_2_data.data[0].get('referred_by_chat_id'):
    referrer_2_id = referrer_2_data.data[0]['referred_by_chat_id']
    
    tree_data_2 = {
        'referrer_chat_id': referrer_2_id,
        'referred_chat_id': new_user_chat_id,
        'level': 2,
        'is_active': True
    }
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç –∏ –≤—Å—Ç–∞–≤–∫–∞
    if not existing_2.data:
        self.client.from_('referral_tree').insert(tree_data_2).execute()
```

#### 4.2.3: –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ —É—Ä–æ–≤–Ω—è 3 (—Ä–µ—Ñ–µ—Ä–µ—Ä —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞)
```python
# –ù–∞—Ö–æ–¥–∏–º, –∫—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ —É—Ä–æ–≤–Ω—è 2
referrer_3_data = self.client.from_(USER_TABLE)
    .select('referred_by_chat_id')
    .eq('chat_id', referrer_2_id)
    .limit(1)
    .execute()

if referrer_3_data.data and referrer_3_data.data[0].get('referred_by_chat_id'):
    referrer_3_id = referrer_3_data.data[0]['referred_by_chat_id']
    
    tree_data_3 = {
        'referrer_chat_id': referrer_3_id,
        'referred_chat_id': new_user_chat_id,
        'level': 3,
        'is_active': True
    }
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç –∏ –≤—Å—Ç–∞–≤–∫–∞
    if not existing_3.data:
        self.client.from_('referral_tree').insert(tree_data_3).execute()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í —Ç–∞–±–ª–∏—Ü–µ `referral_tree` —Å–æ–∑–¥–∞–Ω—ã —Å–≤—è–∑–∏ –¥–ª—è –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π (1, 2, 3)
- –ö–∞–∂–¥–∞—è —Å–≤—è–∑—å —Å–æ–¥–µ—Ä–∂–∏—Ç:
  - `referrer_chat_id`: –ö—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å
  - `referred_chat_id`: –û—Ç –∫–æ–≥–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –±–æ–Ω—É—Å
  - `level`: –£—Ä–æ–≤–µ–Ω—å —Å–≤—è–∑–∏ (1, 2 –∏–ª–∏ 3)
  - `is_active`: True
  - `total_earned_points`: 0 (–ø–æ–∫–∞)
  - `total_transactions`: 0 (–ø–æ–∫–∞)

---

## üí∞ –≠—Ç–∞–ø 5: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞ –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –®–∞–≥ 5.1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞

**–î–µ–π—Å—Ç–≤–∏–µ:**
```python
transaction_data = {
    'client_chat_id': str(chat_id),
    'partner_chat_id': None,
    'total_amount': 0,
    'earned_points': 100,  # WELCOME_BONUS_AMOUNT
    'spent_points': 0,
    'operation_type': 'enrollment_bonus',
    'description': '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏',
    'date_time': datetime.datetime.now().isoformat()
}

self.client.from_(TRANSACTION_TABLE).insert(transaction_data).execute()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–∞–ª–∞–Ω—Å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 100 –±–∞–ª–ª–æ–≤
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü—É `transactions`
- –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏: `enrollment_bonus`

---

## üéÅ –≠—Ç–∞–ø 6: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

### –®–∞–≥ 6.1: –í—ã–∑–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–Ω—É—Å–æ–≤ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

**–î–µ–π—Å—Ç–≤–∏–µ:**
```python
self.process_referral_registration_bonuses(str(chat_id), referrer_chat_id)
```

### –®–∞–≥ 6.2: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

**–ú–µ—Ç–æ–¥:** `_build_referral_tree(new_user_chat_id, level=1, max_level=3)`

**–õ–æ–≥–∏–∫–∞:**
1. –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ—Ö —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `referral_tree`
2. –°–æ–±–∏—Ä–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤ —Å —É—Ä–æ–≤–Ω—è–º–∏ (1, 2, 3)
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤–∏–¥–∞:
```python
[
    {'chat_id': 'referrer_level_1', 'level': 1},
    {'chat_id': 'referrer_level_2', 'level': 2},
    {'chat_id': 'referrer_level_3', 'level': 3}
]
```

### –®–∞–≥ 6.3: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ –≤ –¥–µ—Ä–µ–≤–µ:**

#### 6.3.1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –±–æ–Ω—É—Å–∞ –ø–æ —É—Ä–æ–≤–Ω—é
```python
config = self.REFERRAL_CONFIG
bonus_key = f'level_{level}'  # 'level_1', 'level_2', 'level_3'
bonus_points = config['registration_bonus'].get(bonus_key, 0)
```

**–†–∞–∑–º–µ—Ä—ã –±–æ–Ω—É—Å–æ–≤:**
- –£—Ä–æ–≤–µ–Ω—å 1: 100 –±–∞–ª–ª–æ–≤
- –£—Ä–æ–≤–µ–Ω—å 2: 25 –±–∞–ª–ª–æ–≤
- –£—Ä–æ–≤–µ–Ω—å 3: 10 –±–∞–ª–ª–æ–≤

#### 6.3.2: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
```python
current_balance = self.get_client_balance(int(referrer_id))
new_balance = current_balance + bonus_points

self.client.from_(USER_TABLE)
    .update({BALANCE_COLUMN: new_balance})
    .eq('chat_id', referrer_id)
    .execute()
```

#### 6.3.3: –ó–∞–ø–∏—Å—å –≤ referral_rewards
```python
reward_data = {
    'referrer_chat_id': referrer_id,
    'referred_chat_id': new_user_chat_id,
    'reward_type': 'registration',
    'level': level,
    'points': bonus_points,
    'description': f'–ë–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Ä–µ—Ñ–µ—Ä–∞–ª–∞ —É—Ä–æ–≤–Ω—è {level}'
}

reward_result = self.client.from_('referral_rewards').insert(reward_data).execute()
reward_id = reward_result.data[0]['id']
```

#### 6.3.4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ referral_tree
```python
self.client.from_('referral_tree').update({
    'total_earned_points': bonus_points,
    'total_transactions': 0,
    'is_active': True
}).eq('referrer_chat_id', referrer_id)
  .eq('referred_chat_id', new_user_chat_id)
  .execute()
```

#### 6.3.5: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥
```python
active_period = self.get_active_leaderboard_period()
if active_period and reward_id:
    self.add_leaderboard_metric(
        active_period['id'],
        referrer_id,
        'referral_registration',
        float(bonus_points),
        f'–ë–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Ä–µ—Ñ–µ—Ä–∞–ª–∞ —É—Ä–æ–≤–Ω—è {level}',
        reward_id,
        'referral_rewards'
    )
```

### –®–∞–≥ 6.4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞:**
```python
self.check_and_award_achievements(ref['chat_id'])
```

**–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π:**
- –ü–æ–ª—É—á–∞–µ—Ç `total_referrals` –¥–ª—è —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—Ä–æ–≥–∏:
  - 5 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚Üí 200 –±–∞–ª–ª–æ–≤
  - 10 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚Üí 500 –±–∞–ª–ª–æ–≤
  - 25 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚Üí 1500 –±–∞–ª–ª–æ–≤
  - 50 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚Üí 3000 –±–∞–ª–ª–æ–≤
- –ï—Å–ª–∏ –ø–æ—Ä–æ–≥ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –µ—â—ë –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ:
  - –ù–∞—á–∏—Å–ª—è–µ—Ç –±–æ–Ω—É—Å–Ω—ã–µ –±–∞–ª–ª—ã
  - –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ `referral_rewards` —Å —Ç–∏–ø–æ–º `achievement`

**–†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞ 6:**
- –†–µ—Ñ–µ—Ä–µ—Ä—ã —É—Ä–æ–≤–Ω—è 1, 2, 3 –ø–æ–ª—É—á–∏–ª–∏ –±–æ–Ω—É—Å—ã –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- –í—Å–µ –±–æ–Ω—É—Å—ã –∑–∞–ø–∏—Å–∞–Ω—ã –≤ `referral_rewards`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ `referral_tree`
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥

---

## üõí –≠—Ç–∞–ø 7: –†–µ—Ñ–µ—Ä–∞–ª —Å–æ–≤–µ—Ä—à–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤)

### –®–∞–≥ 7.1: –†–µ—Ñ–µ—Ä–∞–ª —Å–æ–≤–µ—Ä—à–∞–µ—Ç –ø–æ–∫—É–ø–∫—É —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞

**–¢—Ä–∏–≥–≥–µ—Ä:**
- –ü–∞—Ä—Ç–Ω—ë—Ä –Ω–∞—á–∏—Å–ª—è–µ—Ç –±–∞–ª–ª—ã –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –∏–ª–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `sm.execute_transaction(client_chat_id, partner_chat_id, 'accrual', amount)`

### –®–∞–≥ 7.2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–î–µ–π—Å—Ç–≤–∏–µ:**
```python
# –í execute_transaction, –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ –∫–ª–∏–µ–Ω—Ç—É
if txn_type == 'accrual' and transaction_amount_points > 0:
    # –ü–æ–ª—É—á–∞–µ–º ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    transaction_id = recent_txn.data[0].get('id')
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã
    self.process_referral_transaction_bonuses(str(client_chat_id), transaction_amount_points, transaction_id)
```

### –®–∞–≥ 7.3: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

**–ú–µ—Ç–æ–¥:** `_build_referral_tree(user_chat_id, level=1, max_level=3)`

**–õ–æ–≥–∏–∫–∞:**
- –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ—Ö —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–≤–µ—Ä—à–∏–≤—à–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤ —Å —É—Ä–æ–≤–Ω—è–º–∏

### –®–∞–≥ 7.4: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ –≤ –¥–µ—Ä–µ–≤–µ:**

#### 7.4.1: –†–∞—Å—á—ë—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –ø–æ —É—Ä–æ–≤–Ω—é
```python
config = self.REFERRAL_CONFIG
percent_key = f'level_{level}'  # 'level_1', 'level_2', 'level_3'
percent = config['transaction_percent'].get(percent_key, 0.0)
```

**–ü—Ä–æ—Ü–µ–Ω—Ç—ã:**
- –£—Ä–æ–≤–µ–Ω—å 1: 8% (0.08)
- –£—Ä–æ–≤–µ–Ω—å 2: 4% (0.04)
- –£—Ä–æ–≤–µ–Ω—å 3: 2% (0.02)

#### 7.4.2: –†–∞—Å—á—ë—Ç –±–æ–Ω—É—Å–∞
```python
bonus_points = int(earned_points * percent)
```

**–ü—Ä–∏–º–µ—Ä:**
- –†–µ—Ñ–µ—Ä–∞–ª –ø–æ–ª—É—á–∏–ª 1000 –±–∞–ª–ª–æ–≤ –∑–∞ –ø–æ–∫—É–ø–∫—É
- –£—Ä–æ–≤–µ–Ω—å 1 –ø–æ–ª—É—á–∞–µ—Ç: 1000 √ó 0.08 = 80 –±–∞–ª–ª–æ–≤
- –£—Ä–æ–≤–µ–Ω—å 2 –ø–æ–ª—É—á–∞–µ—Ç: 1000 √ó 0.04 = 40 –±–∞–ª–ª–æ–≤
- –£—Ä–æ–≤–µ–Ω—å 3 –ø–æ–ª—É—á–∞–µ—Ç: 1000 √ó 0.02 = 20 –±–∞–ª–ª–æ–≤

#### 7.4.3: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
```python
current_balance = self.get_client_balance(int(referrer_id))
new_balance = current_balance + bonus_points

self.client.from_(USER_TABLE)
    .update({BALANCE_COLUMN: new_balance})
    .eq('chat_id', referrer_id)
    .execute()
```

#### 7.4.4: –ó–∞–ø–∏—Å—å –≤ referral_rewards
```python
reward_data = {
    'referrer_chat_id': referrer_id,
    'referred_chat_id': user_chat_id,
    'reward_type': 'transaction',
    'level': level,
    'points': bonus_points,
    'transaction_id': transaction_id,  # –°–≤—è–∑—å —Å –∏—Å—Ö–æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
    'description': f'–ë–æ–Ω—É—Å {int(percent * 100)}% —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ —É—Ä–æ–≤–Ω—è {level}'
}

reward_result = self.client.from_('referral_rewards').insert(reward_data).execute()
reward_id = reward_result.data[0]['id']
```

#### 7.4.5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ referral_tree
```python
self.client.from_('referral_tree').update({
    'total_earned_points': bonus_points,  # –ù–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è!
    'total_transactions': 1,              # –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è!
    'last_transaction_at': datetime.datetime.now().isoformat(),
    'is_active': True
}).eq('referrer_chat_id', referrer_id)
  .eq('referred_chat_id', user_chat_id)
  .execute()
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `total_earned_points` –≤ `referral_tree` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∞ –Ω–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ, –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞.

#### 7.4.6: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥
```python
active_period = self.get_active_leaderboard_period()
if active_period and reward_id:
    self.add_leaderboard_metric(
        active_period['id'],
        referrer_id,
        'referral_transaction',
        float(bonus_points),
        f'–ë–æ–Ω—É—Å —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ —É—Ä–æ–≤–Ω—è {level}',
        reward_id,
        'referral_rewards'
    )
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞ 7:**
- –í—Å–µ —Ä–µ—Ñ–µ—Ä–µ—Ä—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Å–≤–æ–µ–º—É —É—Ä–æ–≤–Ω—é
- –ë–æ–Ω—É—Å—ã –∑–∞–ø–∏—Å–∞–Ω—ã –≤ `referral_rewards`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ `referral_tree`
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥

---

## üìä –≠—Ç–∞–ø 8: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –®–∞–≥ 8.1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

**–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥:**
```python
stats = sm.get_referral_stats(chat_id)
```

**–ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è:**
```python
{
    'referral_code': 'ABC123',
    'total_referrals': 15,           # –í—Å–µ–≥–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö
    'active_referrals': 12,          # –ê–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
    'total_earnings': 2500,          # –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞—Ö
    'referral_level': 'silver',      # –£—Ä–æ–≤–µ–Ω—å –≤ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
    'referrals_list': [...],         # –°–ø–∏—Å–æ–∫ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —Å –¥–µ—Ç–∞–ª—è–º–∏
    'recent_rewards': [...]          # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –Ω–∞–≥—Ä–∞–¥
}
```

### –®–∞–≥ 8.2: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–æ—Ç–µ

**–ö–æ–º–∞–Ω–¥–∞:** `/referral`

**–°–æ–æ–±—â–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç:**
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É —Å –∫–Ω–æ–ø–∫–æ–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤, –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –±–∞–ª–ª—ã)
- –£—Ä–æ–≤–µ–Ω—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ (–ë—Ä–æ–Ω–∑–∞/–°–µ—Ä–µ–±—Ä–æ/–ó–æ–ª–æ—Ç–æ/–ü–ª–∞—Ç–∏–Ω–∞)
- –ö–Ω–æ–ø–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
- –ö–Ω–æ–ø–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞

### –®–∞–≥ 8.3: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** "–°–æ–æ–±—â–µ—Å—Ç–≤–æ"

**–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:**
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- QR-–∫–æ–¥ –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- –°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –Ω–∞–≥—Ä–∞–¥
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Ä–æ–≤–Ω—è—Ö –∏ –±–æ–Ω—É—Å–∞—Ö

---

## üîÑ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –ü—Ä–∏–º–µ—Ä

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ê–ª–∏—Å–∞ –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –ë–æ–±–∞, –ë–æ–± –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –í–∏–∫—Ç–æ—Ä–∞, –í–∏–∫—Ç–æ—Ä –¥–µ–ª–∞–µ—Ç –ø–æ–∫—É–ø–∫—É

**–ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ê–ª–∏—Å–∞ (chat_id: 111): –±–∞–ª–∞–Ω—Å 0, —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ `ALICE1`
- –ë–æ–± (chat_id: 222): –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
- –í–∏–∫—Ç–æ—Ä (chat_id: 333): –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

---

**–®–∞–≥ 1:** –ê–ª–∏—Å–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å—Å—ã–ª–∫—É
- –°—Å—ã–ª–∫–∞: `https://t.me/mindbeatybot?start=ref_ALICE1`

**–®–∞–≥ 2:** –ë–æ–± –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ –ê–ª–∏—Å—ã
- –ë–æ–± —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è
- `referred_by_chat_id` = 111 (–ê–ª–∏—Å–∞)
- –ë–∞–ª–∞–Ω—Å –ë–æ–±–∞: 100 –±–∞–ª–ª–æ–≤ (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π)

**–®–∞–≥ 3:** –°–æ–∑–¥–∞—ë—Ç—Å—è –¥–µ—Ä–µ–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- `referral_tree`: (referrer: 111, referred: 222, level: 1)

**–®–∞–≥ 4:** –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- –ê–ª–∏—Å–∞ –ø–æ–ª—É—á–∞–µ—Ç 100 –±–∞–ª–ª–æ–≤ (—É—Ä–æ–≤–µ–Ω—å 1)
- –ë–∞–ª–∞–Ω—Å –ê–ª–∏—Å—ã: 100 –±–∞–ª–ª–æ–≤
- –ó–∞–ø–∏—Å—å –≤ `referral_rewards`: (referrer: 111, referred: 222, type: registration, level: 1, points: 100)

**–®–∞–≥ 5:** –ë–æ–± –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ—é —Å—Å—ã–ª–∫—É
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –ë–æ–±–∞: `BOB222`
- –°—Å—ã–ª–∫–∞: `https://t.me/mindbeatybot?start=ref_BOB222`

**–®–∞–≥ 6:** –í–∏–∫—Ç–æ—Ä –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ –ë–æ–±–∞
- –í–∏–∫—Ç–æ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è
- `referred_by_chat_id` = 222 (–ë–æ–±)
- –ë–∞–ª–∞–Ω—Å –í–∏–∫—Ç–æ—Ä–∞: 100 –±–∞–ª–ª–æ–≤ (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π)

**–®–∞–≥ 7:** –°–æ–∑–¥–∞—ë—Ç—Å—è –¥–µ—Ä–µ–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –¥–ª—è –í–∏–∫—Ç–æ—Ä–∞
- `referral_tree`: 
  - (referrer: 222, referred: 333, level: 1) - –ë–æ–±
  - (referrer: 111, referred: 333, level: 2) - –ê–ª–∏—Å–∞

**–®–∞–≥ 8:** –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –í–∏–∫—Ç–æ—Ä–∞
- –ë–æ–± –ø–æ–ª—É—á–∞–µ—Ç 100 –±–∞–ª–ª–æ–≤ (—É—Ä–æ–≤–µ–Ω—å 1)
- –ê–ª–∏—Å–∞ –ø–æ–ª—É—á–∞–µ—Ç 25 –±–∞–ª–ª–æ–≤ (—É—Ä–æ–≤–µ–Ω—å 2)
- –ë–∞–ª–∞–Ω—Å –ë–æ–±–∞: 200 –±–∞–ª–ª–æ–≤ (100 –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö + 100 –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –í–∏–∫—Ç–æ—Ä–∞)
- –ë–∞–ª–∞–Ω—Å –ê–ª–∏—Å—ã: 125 –±–∞–ª–ª–æ–≤ (100 –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ë–æ–±–∞ + 25 –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –í–∏–∫—Ç–æ—Ä–∞)

**–®–∞–≥ 9:** –í–∏–∫—Ç–æ—Ä —Å–æ–≤–µ—Ä—à–∞–µ—Ç –ø–æ–∫—É–ø–∫—É –Ω–∞ 5000 —Ä—É–±–ª–µ–π
- –ü–∞—Ä—Ç–Ω—ë—Ä –Ω–∞—á–∏—Å–ª—è–µ—Ç –í–∏–∫—Ç–æ—Ä—É 500 –±–∞–ª–ª–æ–≤ (10% –æ—Ç —Å—É–º–º—ã)
- –ë–∞–ª–∞–Ω—Å –í–∏–∫—Ç–æ—Ä–∞: 600 –±–∞–ª–ª–æ–≤ (100 –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö + 500 –∑–∞ –ø–æ–∫—É–ø–∫—É)

**–®–∞–≥ 10:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –í–∏–∫—Ç–æ—Ä–∞
- –ë–æ–± –ø–æ–ª—É—á–∞–µ—Ç: 500 √ó 0.08 = 40 –±–∞–ª–ª–æ–≤ (—É—Ä–æ–≤–µ–Ω—å 1, 8%)
- –ê–ª–∏—Å–∞ –ø–æ–ª—É—á–∞–µ—Ç: 500 √ó 0.04 = 20 –±–∞–ª–ª–æ–≤ (—É—Ä–æ–≤–µ–Ω—å 2, 4%)
- –ë–∞–ª–∞–Ω—Å –ë–æ–±–∞: 240 –±–∞–ª–ª–æ–≤ (200 + 40)
- –ë–∞–ª–∞–Ω—Å –ê–ª–∏—Å—ã: 145 –±–∞–ª–ª–æ–≤ (125 + 20)
- –ó–∞–ø–∏—Å–∏ –≤ `referral_rewards`:
  - (referrer: 222, referred: 333, type: transaction, level: 1, points: 40)
  - (referrer: 111, referred: 333, type: transaction, level: 2, points: 20)

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –ë–î

### –¢–∞–±–ª–∏—Ü–∞ `users`
- `chat_id`: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `referral_code`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ (6 —Å–∏–º–≤–æ–ª–æ–≤)
- `referred_by_chat_id`: –ö—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `balance`: –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤
- `registered_via`: –°–ø–æ—Å–æ–± —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ('client_referral', 'partner_link', –∏ —Ç.–¥.)
- `total_referrals`: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- `active_referrals`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- `total_referral_earnings`: –û–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- `referral_level`: –£—Ä–æ–≤–µ–Ω—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ ('bronze', 'silver', 'gold', 'platinum')

### –¢–∞–±–ª–∏—Ü–∞ `referral_tree`
- `referrer_chat_id`: –ö—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å
- `referred_chat_id`: –û—Ç –∫–æ–≥–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –±–æ–Ω—É—Å
- `level`: –£—Ä–æ–≤–µ–Ω—å —Å–≤—è–∑–∏ (1, 2, 3)
- `is_active`: –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ —Å–≤—è–∑—å
- `total_earned_points`: –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –±–∞–ª–ª–æ–≤ —Å —ç—Ç–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞
- `total_transactions`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ä–µ—Ñ–µ—Ä–∞–ª–∞
- `last_transaction_at`: –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞

### –¢–∞–±–ª–∏—Ü–∞ `referral_rewards`
- `referrer_chat_id`: –ö—Ç–æ –ø–æ–ª—É—á–∏–ª –Ω–∞–≥—Ä–∞–¥—É
- `referred_chat_id`: –û—Ç –∫–æ–≥–æ –ø—Ä–∏—à–ª–∞ –Ω–∞–≥—Ä–∞–¥–∞
- `reward_type`: –¢–∏–ø –Ω–∞–≥—Ä–∞–¥—ã ('registration', 'transaction', 'achievement')
- `level`: –£—Ä–æ–≤–µ–Ω—å —Ä–µ—Ñ–µ—Ä–∞–ª–∞ (1, 2, 3)
- `points`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤
- `transaction_id`: ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–¥–ª—è —Ç–∏–ø–∞ 'transaction')
- `description`: –û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã
- `created_at`: –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã

### –¢–∞–±–ª–∏—Ü–∞ `transactions`
- `client_chat_id`: ID –∫–ª–∏–µ–Ω—Ç–∞
- `earned_points`: –ù–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–∞–ª–ª—ã
- `operation_type`: –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ ('enrollment_bonus', 'accrual', –∏ —Ç.–¥.)
- `description`: –û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `date_time`: –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–∞–º–æ—Ä–µ—Ñ–µ—Ä–∞—Ü–∏–∏:** –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥

2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Å—ã–ª–∫–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

3. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞:** –ö–∞–∂–¥—ã–π –∫–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –ë–î

4. **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ë–î

5. **–õ–∏–º–∏—Ç—ã —É—Ä–æ–≤–Ω–µ–π:** –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º 3 —É—Ä–æ–≤–Ω—è —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

6. **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ `referral_tree` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞

7. **–õ–∏–¥–µ—Ä–±–æ—Ä–¥:** –í—Å–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–µ (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω –ø–µ—Ä–∏–æ–¥)

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã –Ω–µ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
1. –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–≤—è–∑—å –≤ `referral_tree`?
   ```sql
   SELECT * FROM referral_tree WHERE referred_chat_id = 'CHAT_ID';
   ```

2. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω `referred_by_chat_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`?
   ```sql
   SELECT chat_id, referred_by_chat_id FROM users WHERE chat_id = 'CHAT_ID';
   ```

3. –ï—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å–∏ –≤ `referral_rewards`?
   ```sql
   SELECT * FROM referral_rewards WHERE referred_chat_id = 'CHAT_ID';
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ë–î
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ–¥–∞ –≤ –ë–î

### –ü—Ä–æ–±–ª–µ–º–∞: –î–µ—Ä–µ–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–µ–ø–æ–ª–Ω–æ—Å—Ç—å—é

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ø–æ—á–∫—É `referred_by_chat_id` –≤–≤–µ—Ä—Ö –ø–æ —É—Ä–æ–≤–Ω—è–º
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Ü–µ–ø–æ—á–∫–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –º–µ—Ç–æ–¥–∞ `_create_referral_tree_links`


