# LoyalityBot — инструкция для Claude Code

## О проекте

**LoyalityBot** — бот лояльности для партнёров: начисление/списание баллов, реферальная система, NPS, акции, админ-панель. Бэкенд на Python (Telegram-боты, Supabase), фронтенд (React/Vite), деплой на **Cloudflare**.

- **Корень:** Python-скрипты, `supabase_manager.py`, боты, миграции, тесты.
- **frontend/** — React-приложение (Vite, .mjs/.jsx).
- **cloudflare/** — воркеры и конфиг деплоя (Cloudflare).
- **migrations/** — SQL-миграции Supabase (порядок и совместимость важны).
- **tests/** — pytest.

## Правила работы (обязательны)

### Изменения кода

- **Не рефакторить и не упрощать** существующий код без явной просьбы пользователя.
- **Не переименовывать** функции, классы, файлы и поля БД без явного запроса.
- **Минимальный diff:** менять только то, что нужно для задачи; без косметических правок и «улучшений».
- **Не менять код вне** указанной пользователем функции/файла/области.
- **Сохранять** порядок импортов и структуру файлов.

### Конфигурация и секреты

- **Не трогать** файлы с ключами, секретами и чувствительными данными (`.env`, `secrets/`, `*.pem`, `service_account.json`, `.streamlit/secrets.toml` и т.п.). Не читать их и не предлагать в них правки.

### Деплой и инфраструктура

- **Деплой — только Cloudflare.** Не предлагать и не упоминать Render, Fly.io, Vercel, Netlify, свой сервер и т.п.

### Если нужно что-то улучшить

1. Кратко описать предлагаемые изменения и зачем они нужны.
2. Дождаться явного подтверждения пользователя перед правками в файлах.

## Анализ и отчёты

- По запросу «проанализировать» или «прогнать проект» — **только анализ:** перечень проблем, багов, рисков, дублирования с указанием файлов и строк. **Не вносить изменения** в код, если пользователь не попросил их внести.
- При исправлении багов — точечные правки, затем предложить запустить тесты.

## Полезные пути

- Документация по проекту: `PROJECT_SUMMARY.md`, `QUICK_START_LOCAL.md`, `API_DOCUMENTATION.md`.
- Тесты: `pytest` из корня, конфиг `pytest.ini`.
- Миграции: применяются в Supabase; не менять порядок и не выполнять без явного запроса.
