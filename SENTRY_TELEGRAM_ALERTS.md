# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Sentry Alerts ‚Üí Telegram

## üéØ –¶–µ–ª—å
–ü–æ–ª—É—á–∞—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö –∏–∑ Sentry.

---

## üìã –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Sentry UI (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook –≤ Sentry

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –≤ Sentry: https://sentry.io/organizations/YOUR_ORG/projects/
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Integrations**
3. –ù–∞–π–¥–∏—Ç–µ **Webhooks** –∏ –Ω–∞–∂–º–∏—Ç–µ **Add to Project**
4. –í–≤–µ–¥–∏—Ç–µ Callback URL: `https://YOUR_DOMAIN/api/sentry-webhook` (—Å–º. –í–∞—Ä–∏–∞–Ω—Ç B)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ Alert Rules

1. –í –ø—Ä–æ–µ–∫—Ç–µ Sentry –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Alerts** ‚Üí **Create Alert**
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: **Issues**
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É—Å–ª–æ–≤–∏—è:
   - **When**: `An issue is first seen` (–ø–µ—Ä–≤–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏)
   - **When**: `An issue changes state from resolved to unresolved` (–æ—à–∏–±–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å)
   - **When**: `The issue is seen more than 10 times in 1 minute` (—á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏)
4. –í **Then perform these actions** –≤—ã–±–µ—Ä–∏—Ç–µ **Send a notification via Webhooks**
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ Alert Rule

---

## üîß –í–∞—Ä–∏–∞–Ω—Ç B: Webhook Handler (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)

### –°–æ–∑–¥–∞–π—Ç–µ endpoint –≤ secure_api.py –¥–ª—è –ø—Ä–∏—ë–º–∞ webhooks –æ—Ç Sentry

Webhook handler —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `secure_api.py`. –û–Ω –±—É–¥–µ—Ç:
- –ü—Ä–∏–Ω–∏–º–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Sentry
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∫—Ä–∞—Å–∏–≤–æ
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π Telegram —á–∞—Ç

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:

1. **–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:**
```env
# Telegram –¥–ª—è Sentry –∞–ª–µ—Ä—Ç–æ–≤
SENTRY_ALERT_TELEGRAM_TOKEN=YOUR_BOT_TOKEN  # –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤
SENTRY_ALERT_CHAT_ID=YOUR_CHAT_ID           # –í–∞—à chat_id –∏–ª–∏ –≥—Ä—É–ø–ø—ã
SENTRY_WEBHOOK_SECRET=your_random_secret    # –°–µ–∫—Ä–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ webhook
```

2. **–ü–æ–ª—É—á–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π URL –¥–ª—è webhook:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok: `ngrok http 8001`
   - –ò–ª–∏ –¥–µ–ø–ª–æ–π –Ω–∞ Vercel/Railway/–¥—Ä—É–≥–æ–π —Ö–æ—Å—Ç–∏–Ω–≥
   - URL –±—É–¥–µ—Ç: `https://your-domain.com/api/sentry-webhook`

3. **–î–æ–±–∞–≤—å—Ç–µ URL –≤ Sentry:**
   - Settings ‚Üí Integrations ‚Üí Webhooks
   - Callback URL: `https://your-domain.com/api/sentry-webhook`
   - Secret: —Ç–æ—Ç –∂–µ, —á—Ç–æ –≤ `.env`

---

## üì± –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ Telegram –±–æ—Ç–∞ –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
/newbot
# –ò–º—è: Sentry Alerts Bot
# Username: your_sentry_alerts_bot

# 2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ .env
SENTRY_ALERT_TELEGRAM_TOKEN=123456:ABC-DEF...

# 3. –£–∑–Ω–∞–π—Ç–µ –≤–∞—à chat_id
# –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É /start –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ:
# https://api.telegram.org/bot<YOUR_TOKEN>/getUpdates

# 4. –î–æ–±–∞–≤—å—Ç–µ chat_id –≤ .env
SENTRY_ALERT_CHAT_ID=123456789
```

---

## üé® –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```
üö® SENTRY ALERT

‚ùå ZeroDivisionError
division by zero

üìç Location: secure_api.py:59 in trigger_error

üîó View in Sentry: https://sentry.io/issues/...

Environment: production
Release: loyaltybot@1.0.0
First Seen: 2025-11-15 16:28:23
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –í—ã–∑–æ–≤–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –æ—à–∏–±–∫—É —á–µ—Ä–µ–∑ API –∏–ª–∏ –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ –≤ Telegram
3. –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `logs/partner_bot.log`

---

## üîÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é –≤–∞–∂–Ω–æ—Å—Ç–∏

–í Alert Rules –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã:
- –¢–æ–ª—å–∫–æ `error` –∏ `fatal` —É—Ä–æ–≤–Ω–∏
- –¢–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (production)
- –¢–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (bot.py, secure_api.py)

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–ø–∞–º–∞:
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–∏–º–∏—Ç: "–Ω–µ –±–æ–ª–µ–µ 1 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 5 –º–∏–Ω—É—Ç –¥–ª—è –æ–¥–Ω–æ–π –æ—à–∏–±–∫–∏"
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ digest: "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–≤–æ–¥–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å"

---

## üìä –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ Alert Rules

1. **Critical Errors** - –ª—é–±–∞—è –æ—à–∏–±–∫–∞ —É—Ä–æ–≤–Ω—è `error` –∏–ª–∏ `fatal`
2. **New Issues** - –ø–µ—Ä–≤–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –æ—à–∏–±–∫–∏
3. **Regression** - –æ—à–∏–±–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞, –ø–æ—è–≤–∏–ª–∞—Å—å —Å–Ω–æ–≤–∞
4. **High Frequency** - –±–æ–ª–µ–µ 10 –æ—à–∏–±–æ–∫ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –∑–∞ –º–∏–Ω—É—Ç—É
5. **Performance Issues** - –∑–∞–ø—Ä–æ—Å—ã –º–µ–¥–ª–µ–Ω–Ω–µ–µ 3 —Å–µ–∫—É–Ω–¥



