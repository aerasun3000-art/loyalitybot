# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: B2B Deals –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–π —Å–ª–æ–π –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 29.01.2026  
**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Å —Ç–µ—Å—Ç–∞–º–∏)

---

## –ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å (—Å–≤–æ–¥–∫–∞)

| –ß—Ç–æ | –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å |
|-----|----------------|
| **–ú–∏–≥—Ä–∞—Ü–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫** | `migrations/create_partner_broadcast_campaigns.sql` ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase SQL Editor |
| **–†–∞—Å—Å—ã–ª–∫–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞** | –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π –±–æ—Ç ‚Üí ¬´üë• –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞¬ª ‚Üí ¬´üì¢ –†–∞–∑–æ—Å–ª–∞—Ç—å –≤—Å–µ–º –º–æ–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º¬ª |
| **–®–∞–±–ª–æ–Ω —Ä–∞—Å—Å—ã–ª–∫–∏** | –í –∫–æ–¥–µ: `bot.py` ‚Äî callback `invite_broadcast_start` / `invite_broadcast_confirm`, –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `template_text` |
| **–ü—Ä–æ–º–æ (QR)** | –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π –±–æ—Ç ‚Üí ¬´üë• –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞¬ª ‚Üí ¬´üîó –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É¬ª ‚Üí ¬´üì• –°–∫–∞—á–∞—Ç—å –ø—Ä–æ–º–æ (QR)¬ª |
| **B2B —Å–¥–µ–ª–∫–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–∞** | –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π –±–æ—Ç ‚Üí ¬´‚öôÔ∏è –ï—â—ë¬ª ‚Üí ¬´–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ (B2B Deals)¬ª |
| **–†–µ–∂–∏–º –±–ª–æ–≥–µ—Ä/–∏–Ω—Ñ–ª—é–µ–Ω—Å–µ—Ä** | –ü–∞—Ä—Ç–Ω—ë—Ä—ã —Å `category_group = 'influencer'` –ø–æ–ª—É—á–∞—é—Ç 5% –æ—Ç —á–µ–∫–∞ –ø—Ä–∏–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —É –ª—é–±–æ–≥–æ –ø—Ä–æ–¥–∞–≤—Ü–∞ (–µ—Å–ª–∏ –Ω–µ—Ç B2B —Å–¥–µ–ª–∫–∏). –õ–æ–≥–∏–∫–∞: `referral_calculator.py` (–≤–µ—Ç–∫–∞ `blogger_platform`), –≤—ã–∑–æ–≤: `supabase_manager.py` ‚Üí `process_referral_transaction_bonuses` |
| **–¶–µ–ø–æ—á–∫–∞ –ø–∞—Ä—Ç–Ω—ë—Ä = L1** | –ö–ª–∏–µ–Ω—Ç—ã, –ø—Ä–∏—à–µ–¥—à–∏–µ –ø–æ —Å—Å—ã–ª–∫–µ –ø–∞—Ä—Ç–Ω—ë—Ä–∞: –≤ —Ä–∞—Å—á—ë—Ç–µ –∫–æ–º–∏—Å—Å–∏–π –ø–∞—Ä—Ç–Ω—ë—Ä —Å—á–∏—Ç–∞–µ—Ç—Å—è L1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: `supabase_manager.py` ‚Üí `_build_users_dict_for_calculator` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `referral_source`) |
| **–¢–µ—Å—Ç—ã** | `python3 referral_calculator.py -v` (3 —Ç–µ—Å—Ç–∞); `python3 -m pytest tests/test_supabase_manager.py tests/test_partner_bot.py tests/test_database_migrations.py tests/test_referral_calculator.py -v` (145 —Ç–µ—Å—Ç–æ–≤) |

---

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (29.01.2026)

### –ë–ª–æ–∫ A: –†–∞—Å—Å—ã–ª–∫–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞ —Å–≤–æ–µ–π –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑–µ
- –ú–∏–≥—Ä–∞—Ü–∏—è `migrations/create_partner_broadcast_campaigns.sql` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `partner_broadcast_campaigns`.
- –í `supabase_manager`: `get_partner_client_chat_ids_for_broadcast`, `can_partner_run_broadcast`, `create_broadcast_campaign`, `update_broadcast_campaign_finished`.
- –í –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–æ–º –±–æ—Ç–µ: –∫–Ω–æ–ø–∫–∞ ¬´üì¢ –†–∞–∑–æ—Å–ª–∞—Ç—å –≤—Å–µ–º –º–æ–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º¬ª –≤ –º–µ–Ω—é ¬´üë• –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞¬ª; —à–∞–±–ª–æ–Ω ¬´–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞¬ª, –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —Ä–∞—Å—Å—ã–ª–∫–∞ —Å –ª–∏–º–∏—Ç–æ–º 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ –∏ –¥–æ 500 –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π; –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–π.

### –ë–ª–æ–∫ B: –ö–∞–±–∏–Ω–µ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –ø–æ B2B —Å–¥–µ–ª–∫–∞–º
- –£–∂–µ –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω: –º–µ–Ω—é ¬´–ï—â—ë¬ª ‚Üí ¬´–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ (B2B Deals)¬ª ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö —Å–¥–µ–ª–æ–∫, –≤—Ö–æ–¥—è—â–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.

### –ë–ª–æ–∫ C: –†–µ–∂–∏–º ¬´–ë–ª–æ–≥–µ—Ä / –∏–Ω—Ñ–ª—é–µ–Ω—Å–µ—Ä¬ª
- –í `referral_calculator`: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `partner_influencer_ids`, `blogger_platform_percent`; –≤–µ—Ç–∫–∞ –ª–æ–≥–∏–∫–∏ `blogger_platform` ‚Äî –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ B2B —Å–¥–µ–ª–∫–∏, –µ—Å–ª–∏ L1 —Ä–µ—Ñ–µ—Ä–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî –ø–∞—Ä—Ç–Ω—ë—Ä —Å `category_group = 'influencer'`, –µ–º—É –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è 5% –æ—Ç —á–µ–∫–∞ (70% –ø–∞—Ä—Ç–Ω—ë—Ä—É, 30% —Å–∏—Å—Ç–µ–º–µ).
- –í `supabase_manager`: `get_influencer_partner_chat_ids()`, –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ –∫–æ–º–∏—Å—Å–∏–π –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä; –≤ `_build_users_dict_for_calculator` —É—á—ë—Ç `referral_source` (–ø–∞—Ä—Ç–Ω—ë—Ä-–ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–∏–π) –∫–∞–∫ L1 –¥–ª—è B2B/–±–ª–æ–≥–µ—Ä–∞.

### –ë–ª–æ–∫ E: –®–∞–±–ª–æ–Ω—ã –∏ –ø—Ä–æ–º–æ-–º–∞—Ç–µ—Ä–∏–∞–ª—ã
- –®–∞–±–ª–æ–Ω —Ä–∞—Å—Å—ã–ª–∫–∏ ¬´–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞¬ª –≤—Å—Ç—Ä–æ–µ–Ω –≤ –∫–Ω–æ–ø–∫—É —Ä–∞—Å—Å—ã–ª–∫–∏.
- –ö–Ω–æ–ø–∫–∞ ¬´üì• –°–∫–∞—á–∞—Ç—å –ø—Ä–æ–º–æ (QR)¬ª –≤ –º–µ–Ω—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ QR-–∫–æ–¥–∞ —Å –ø–æ–¥–ø–∏—Å—å—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö/–æ—Ñ–ª–∞–π–Ω.
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `get_client_bot_username()` (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π username –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –±–æ—Ç–∞).

---

## –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

- –ë–ª–æ–∫ D: –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è MLM (–∫–ª–∏–µ–Ω—Ç –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞) ‚Äî –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –ø–æ –¥–∏–∑–∞–π–Ω—É –≤ `MLM_SYSTEM_VARIANTS.md`.
- –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ —Ä–∞—Å—Å—ã–ª–∫–∏).
- –ë–∞–Ω–Ω–µ—Ä-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ QR).

---

## –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase:
   ```bash
   # –í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:
   migrations/create_partner_broadcast_campaigns.sql
   ```
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–æ–≥–æ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `bot.py`, `supabase_manager.py`, `referral_calculator.py`.

---

## –¢–µ—Å—Ç—ã (–ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞)

- **–®–∞–≥ 1 ‚Äî referral_calculator:** `python3 referral_calculator.py -v` ‚Äî 3 —Ç–µ—Å—Ç–∞ (standard, b2b, blogger_platform). ‚úÖ
- **–®–∞–≥ 2 ‚Äî supabase_manager:** `python3 -m pytest tests/test_supabase_manager.py -v` ‚Äî 33 —Ç–µ—Å—Ç–∞, –≤ —Ç.—á. 8 –Ω–æ–≤—ã—Ö (broadcast, influencer). ‚úÖ
- **–®–∞–≥ 3 ‚Äî partner_bot:** `python3 -m pytest tests/test_partner_bot.py -v` ‚Äî 35 —Ç–µ—Å—Ç–æ–≤, –≤ —Ç.—á. 3 –Ω–æ–≤—ã—Ö (invite/broadcast callbacks). ‚úÖ
- **–ú–∏–≥—Ä–∞—Ü–∏—è:** `tests/test_database_migrations.py::TestDatabaseSchema::test_partner_broadcast_campaigns_table_columns` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ —Ç–∞–±–ª–∏—Ü—ã. ‚úÖ
- **–ü–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω:** `python3 referral_calculator.py -v && python3 -m pytest tests/test_supabase_manager.py tests/test_partner_bot.py tests/test_database_migrations.py tests/test_referral_calculator.py -v` ‚Äî 3 + 145 —Ç–µ—Å—Ç–æ–≤. ‚úÖ
