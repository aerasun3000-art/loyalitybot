# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Sentry Webhooks ‚Üí Telegram

## üéØ –¶–µ–ª—å
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ Sentry –≤ Telegram –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫.

---

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Sentry Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://sentry.io/
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π)

---

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook Integration

1. –í –ø—Ä–æ–µ–∫—Ç–µ Sentry –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** (‚öôÔ∏è –≤ –ª–µ–≤–æ–º –º–µ–Ω—é)
2. –í—ã–±–µ—Ä–∏—Ç–µ **Integrations** –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é
3. –ù–∞–π–¥–∏—Ç–µ **Webhooks** –≤ —Å–ø–∏—Å–∫–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
4. –ù–∞–∂–º–∏—Ç–µ **Add to Project** –∏–ª–∏ **Configure**

---

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook URL

**–í–∞–∂–Ω–æ:** –î–ª—è —Ä–∞–±–æ—Ç—ã webhook –Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π URL –≤–∞—à–µ–≥–æ API.

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ngrok (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
brew install ngrok

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç—É–Ω–Ω–µ–ª—å –∫ –≤–∞—à–µ–º—É API
ngrok http 8003

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ HTTPS URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://abc123.ngrok.io)
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Deploy –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥ (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

- **Railway**: https://railway.app
- **Render**: https://render.com  
- **Fly.io**: https://fly.io
- **Vercel** (serverless): https://vercel.com

---

### –®–∞–≥ 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Webhook –≤ Sentry

1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Webhook –≤ Sentry:
   - **Callback URL**: `https://your-domain.com/api/sentry-webhook`
     - –î–ª—è ngrok: `https://abc123.ngrok.io/api/sentry-webhook`
     - –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: `https://your-api-domain.com/api/sentry-webhook`
   
   - **Secret** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `.env`:
     ```bash
     grep SENTRY_WEBHOOK_SECRET .env
     ```
     –ò–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –Ω–∞—á–∞–ª–∞

2. –ù–∞–∂–º–∏—Ç–µ **Save Changes**

---

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Alert Rules

1. –í –ø—Ä–æ–µ–∫—Ç–µ Sentry –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Alerts** ‚Üí **Create Alert**
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: **Issues**
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É—Å–ª–æ–≤–∏—è:

   **When:**
   - ‚úÖ `An issue is first seen` (–ø–µ—Ä–≤–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏)
   - ‚úÖ `An issue changes state from resolved to unresolved` (–æ—à–∏–±–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å)
   - ‚úÖ `The issue is seen more than 10 times in 1 minute` (—á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏)

4. –í —Ä–∞–∑–¥–µ–ª–µ **Then perform these actions**:
   - –í—ã–±–µ—Ä–∏—Ç–µ **Send a notification via Webhooks**
   - –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π webhook

5. –ù–∞–∂–º–∏—Ç–µ **Save Alert Rule**

---

### –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ API (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

```bash
# –í—ã–∑–æ–≤–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –æ—à–∏–±–∫—É
curl http://127.0.0.1:8003/sentry-debug

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Sentry Dashboard - –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram - –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
python test_sentry_webhook.py
```

#### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ Sentry UI

1. –í Sentry Dashboard ‚Üí **Settings** ‚Üí **Integrations** ‚Üí **Webhooks**
2. –ù–∞–∂–º–∏—Ç–µ **Test** —Ä—è–¥–æ–º —Å –≤–∞—à–∏–º webhook
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ webhook endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
curl http://127.0.0.1:8003/api/sentry-webhook -X POST \
  -H "Content-Type: application/json" \
  -d '{"test": "data"}'

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON –æ—Ç–≤–µ—Ç
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ secure_api
tail -f logs/secure_api.log

# –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ webhook
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram

- –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
- –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –∏–∑ `SENTRY_ALERT_TELEGRAM_TOKEN`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–∏—Ö–æ–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## üêõ Troubleshooting

### Webhook –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL:**
   ```bash
   # –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
   echo "https://your-domain.com/api/sentry-webhook"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:**
   ```bash
   curl http://127.0.0.1:8003/health
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   tail -f logs/secure_api.log
   ```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   grep SENTRY_ALERT .env
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:**
   ```bash
   # –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –≤—Ä—É—á–Ω—É—é
   curl -X POST "https://api.telegram.org/bot<YOUR_TOKEN>/sendMessage" \
     -d "chat_id=<YOUR_CHAT_ID>&text=Test"
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω:**
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã

### –û—à–∏–±–∫–∞ 401 (Invalid signature)

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `SENTRY_WEBHOOK_SECRET`:
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ–∫—Ä–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤ Sentry –∏ `.env`
2. –ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ (–æ—Å—Ç–∞–≤—å—Ç–µ Secret –ø—É—Å—Ç—ã–º –≤ Sentry)

---

## üìä –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```
‚ùå SENTRY ALERT

ERROR: ZeroDivisionError: division by zero

üìç Location: secure_api.py:155 in trigger_error

üåç Environment: production
üì¶ Release: loyaltybot@1.0.0
üî¢ Events: 1

üîó View in Sentry
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [ ] Webhook –¥–æ–±–∞–≤–ª–µ–Ω –≤ Sentry
- [ ] URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] Alert Rules —Å–æ–∑–¥–∞–Ω—ã
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ –≤ Telegram
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üöÄ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ Telegram!

---

*–î–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ–º–æ—â–∏ —Å–º. `SENTRY_TELEGRAM_ALERTS.md`*


