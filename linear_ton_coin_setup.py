#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ TON COIN Integration –∏ –≤—Å–µ—Ö –∑–∞–¥–∞—á –≤ Linear
–û—Å–Ω–æ–≤–∞–Ω –Ω–∞ roadmap –∏–∑ TON_COIN_MINDMAP_ROADMAP.md
"""

import os
import requests
from typing import List, Dict, Optional
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

LINEAR_API_URL = "https://api.linear.app/graphql"


class LinearTONCoinSetup:
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–¥–∞—á –¥–ª—è TON COIN –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"""
    
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.headers = {
            "Authorization": api_key,
            "Content-Type": "application/json"
        }
        self.team_id = None
        self.project_id = None
        
    def _make_request(self, query: str, variables: Dict = None) -> Dict:
        """–í—ã–ø–æ–ª–Ω–∏—Ç—å GraphQL –∑–∞–ø—Ä–æ—Å"""
        payload = {"query": query}
        if variables:
            payload["variables"] = variables
            
        response = requests.post(
            LINEAR_API_URL,
            headers=self.headers,
            json=payload
        )
        
        if response.status_code != 200:
            raise Exception(f"Linear API error: {response.status_code} - {response.text}")
            
        data = response.json()
        if "errors" in data:
            raise Exception(f"Linear GraphQL errors: {data['errors']}")
            
        return data["data"]
    
    def get_teams(self) -> List[Dict]:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥"""
        query = """
        query {
            teams {
                nodes {
                    id
                    name
                    key
                }
            }
        }
        """
        data = self._make_request(query)
        return data["teams"]["nodes"]
    
    def get_team_id(self, team_key: Optional[str] = None) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å ID –∫–æ–º–∞–Ω–¥—ã"""
        if self.team_id:
            return self.team_id
            
        teams = self.get_teams()
        
        if not teams:
            raise Exception("No teams found in Linear workspace")
        
        if team_key:
            for team in teams:
                if team["key"] == team_key:
                    self.team_id = team["id"]
                    return self.team_id
            raise Exception(f"Team with key '{team_key}' not found")
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—É—é –∫–æ–º–∞–Ω–¥—É –∏–ª–∏ ENGINE
        for team in teams:
            if team["key"] in ["ENGI", "ENG", "ENGINE"]:
                self.team_id = team["id"]
                return self.team_id
        
        self.team_id = teams[0]["id"]
        return self.team_id
    
    def create_project(self, name: str, description: str) -> str:
        """–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ Linear"""
        if not self.team_id:
            self.get_team_id()
            
        query = """
        mutation($input: ProjectCreateInput!) {
            projectCreate(input: $input) {
                success
                project {
                    id
                    name
                    url
                }
            }
        }
        """
        variables = {
            "input": {
                "name": name,
                "description": description,
                "teamIds": [self.team_id]
            }
        }
        data = self._make_request(query, variables)
        
        if not data["projectCreate"]["success"]:
            raise Exception("Failed to create project")
            
        self.project_id = data["projectCreate"]["project"]["id"]
        return self.project_id
    
    def get_project_id(self, project_name: str) -> Optional[str]:
        """–ü–æ–ª—É—á–∏—Ç—å ID –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ –∏–º–µ–Ω–∏"""
        if not self.team_id:
            self.get_team_id()
            
        query = """
        query($teamId: String!) {
            team(id: $teamId) {
                projects {
                    nodes {
                        id
                        name
                    }
                }
            }
        }
        """
        data = self._make_request(query, {"teamId": self.team_id})
        projects = data["team"]["projects"]["nodes"]
        
        for project in projects:
            if project["name"] == project_name:
                return project["id"]
        return None
    
    def create_issue(self, title: str, description: str, 
                     priority: int = 3,
                     assignee_id: Optional[str] = None) -> Dict:
        """–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –≤ Linear"""
        if not self.team_id:
            self.get_team_id()
            
        query = """
        mutation($input: IssueCreateInput!) {
            issueCreate(input: $input) {
                success
                issue {
                    id
                    identifier
                    title
                    url
                }
            }
        }
        """
        
        input_data = {
            "title": title,
            "description": description,
            "teamId": self.team_id,
            "priority": priority
        }
        
        if self.project_id:
            input_data["projectId"] = self.project_id
            
        if assignee_id:
            input_data["assigneeId"] = assignee_id
            
        variables = {"input": input_data}
        
        data = self._make_request(query, variables)
        
        if not data["issueCreate"]["success"]:
            raise Exception("Failed to create issue")
            
        return data["issueCreate"]["issue"]
    
    def setup_ton_coin_project(self, team_key: Optional[str] = None):
        """–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç TON COIN Integration –∏ –≤—Å–µ –∑–∞–¥–∞—á–∏"""
        
        print("üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ TON COIN Integration –≤ Linear...\n")
        
        # –ü–æ–ª—É—á–∞–µ–º –∫–æ–º–∞–Ω–¥—É
        try:
            self.get_team_id(team_key)
            teams = self.get_teams()
            current_team = next((t for t in teams if t["id"] == self.team_id), None)
            print(f"üìã –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞: {current_team['name']} ({current_team['key']})\n")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã: {e}")
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–æ–µ–∫—Ç
        project_id = self.get_project_id("TON COIN Integration")
        if project_id:
            self.project_id = project_id
            print(f"‚úÖ –ü—Ä–æ–µ–∫—Ç 'TON COIN Integration' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n")
        else:
            # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–µ–∫—Ç (–æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å <= 255 —Å–∏–º–≤–æ–ª–æ–≤)
            project_description = "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TON –±–ª–æ–∫—á–µ–π–Ω–∞ –¥–ª—è –≤—ã–ø–ª–∞—Ç Revenue Share. –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã (5-10 —Å–µ–∫), –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ (~$0.01), –Ω–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 6 –Ω–µ–¥–µ–ª—å."
            
            try:
                self.create_project("TON COIN Integration", project_description.strip())
                print(f"‚úÖ –ü—Ä–æ–µ–∫—Ç 'TON COIN Integration' —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!\n")
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞: {e}")
                return
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–¥–∞—á–∏ –∏–∑ roadmap
        tasks = self._get_tasks_from_roadmap()
        
        print(f"üìù –°–æ–∑–¥–∞–Ω–∏–µ {len(tasks)} –∑–∞–¥–∞—á...\n")
        
        created_count = 0
        skipped_count = 0
        
        for task in tasks:
            try:
                issue = self.create_issue(
                    title=task["title"],
                    description=task["description"],
                    priority=task.get("priority", 3)
                )
                print(f"‚úÖ {issue['identifier']}: {task['title']}")
                created_count += 1
            except Exception as e:
                print(f"‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É '{task['title']}': {e}")
                skipped_count += 1
        
        print(f"\n{'='*60}")
        print(f"‚úÖ –°–æ–∑–¥–∞–Ω–æ –∑–∞–¥–∞—á: {created_count}")
        if skipped_count > 0:
            print(f"‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ –∑–∞–¥–∞—á: {skipped_count}")
        print(f"{'='*60}\n")
    
    def _get_tasks_from_roadmap(self) -> List[Dict]:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –∏–∑ roadmap"""
        
        tasks = []
        
        # –§–ê–ó–ê 1: –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê (–ù–µ–¥–µ–ª—è 1-2)
        tasks.append({
            "title": "–§–ê–ó–ê 1.1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è - –ò–∑—É—á–µ–Ω–∏–µ TON –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ—à–µ–ª—å–∫–∞",
            "description": """
**–î–µ–Ω—å 1-2**

**–ó–∞–¥–∞—á–∏:**
- [ ] –ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é TON (https://ton.org/docs)
- [ ] –í—ã–±—Ä–∞—Ç—å SDK (pytonlib vs ton-python)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ—à–µ–ª–µ–∫ –Ω–∞ TON testnet
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ testnet
- [ ] –°–æ–∑–¥–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –≤—ã–ø–ª–∞—Ç
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å seed-—Ñ—Ä–∞–∑—É –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (env/secrets)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ TON network (mainnet/testnet)
- [ ] –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á –¥–ª—è –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç (CoinGecko/Binance)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å TON
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `TON_SETUP_GUIDE.md`
            """,
            "priority": 1  # Urgent
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 1.2: SQL –º–∏–≥—Ä–∞—Ü–∏–∏ - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã partners",
            "description": """
**–î–µ–Ω—å 3-4**

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `supabase_ton_integration_partners.sql`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è:
  - `ton_wallet_address VARCHAR(48)`
  - `payment_method VARCHAR(20) DEFAULT 'bank'`
  - `ton_wallet_verified BOOLEAN DEFAULT FALSE`
  - `ton_wallet_setup_at TIMESTAMP`
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å rollback —Å–∫—Ä–∏–ø—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ partners —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π TON
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 1.3: SQL –º–∏–≥—Ä–∞—Ü–∏–∏ - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã ton_payments",
            "description": """
**–î–µ–Ω—å 3-4**

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `supabase_ton_integration_payments.sql`
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `ton_payments` —Å –ø–æ–ª—è–º–∏:
  - id, partner_chat_id, revenue_share_id
  - amount_nano, amount_usd, exchange_rate
  - ton_tx_hash, ton_tx_lt, ton_block_seqno
  - status, comment, error_message
  - created_at, sent_at, confirmed_at
  - retry_count, last_retry_at
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 1.4: SQL –º–∏–≥—Ä–∞—Ü–∏–∏ - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ partner_revenue_share",
            "description": """
**–î–µ–Ω—å 3-4**

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `supabase_ton_integration_revenue_share.sql`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ `partner_revenue_share`:
  - `payment_method VARCHAR(20) DEFAULT 'bank'`
  - `ton_tx_hash VARCHAR(64)`
  - `ton_payment_id UUID REFERENCES ton_payments(id)`
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TON –≤—ã–ø–ª–∞—Ç –≤ —Å–∏—Å—Ç–µ–º—É Revenue Share
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 1.5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è",
            "description": """
**–î–µ–Ω—å 5**

**–ó–∞–¥–∞—á–∏:**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `requirements.txt`:
  - `pytonlib>=0.1.0` (–∏–ª–∏ `ton-python>=2.0.0`)
  - `aiohttp>=3.9.0`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `.env.example`:
  - TON_WALLET_ADDRESS
  - TON_WALLET_SEED
  - TON_NETWORK
  - EXCHANGE_RATE_API
  - COINGECKO_API_KEY (–∏–ª–∏ BINANCE_API_KEY)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ Fly.io/deployment

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
            """,
            "priority": 2  # High
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 1.6: –°–æ–∑–¥–∞–Ω–∏–µ TONPaymentService - –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞",
            "description": """
**–î–µ–Ω—å 6-7**

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `ton_payment_service.py`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å `TONPaymentService`
- [ ] –ú–µ—Ç–æ–¥—ã:
  - `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  - `get_ton_price()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ (–∑–∞–≥–ª—É—à–∫–∞)
  - `send_payment()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–∑–∞–≥–ª—É—à–∫–∞)
  - `check_transaction_status()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (–∑–∞–≥–ª—É—à–∫–∞)
  - `validate_wallet_address()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ (–∑–∞–≥–ª—É—à–∫–∞)
- [ ] –î–æ–±–∞–≤–∏—Ç—å docstrings –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞ –≥–æ—Ç–æ–≤–∞
            """,
            "priority": 2
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 1.7: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ TONPaymentService",
            "description": """
**–î–µ–Ω—å 8-9**

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_ton_price()`:
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CoinGecko/Binance API
  - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 5 –º–∏–Ω—É—Ç
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ fallback
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `validate_wallet_address()`:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ (EQ... –∏–ª–∏ 0:...)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ checksum
  - –¢–µ—Å—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `send_payment()`:
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
  - –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - –í–æ–∑–≤—Ä–∞—Ç tx_hash –∏ —Å—Ç–∞—Ç—É—Å–∞
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `check_transaction_status()`:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π TONPaymentService
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 1.8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤",
            "description": """
**–î–µ–Ω—å 10**

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å `tests/test_ton_payment_service.py`
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ testnet
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å pytest –¥–ª—è async —Ç–µ—Å—Ç–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ –≥–æ—Ç–æ–≤—ã–π –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å
            """,
            "priority": 2
        })
        
        # –§–ê–ó–ê 2: BACKEND –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø (–ù–µ–¥–µ–ª—è 3)
        tasks.append({
            "title": "–§–ê–ó–ê 2.1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Revenue Share - –û–±—Ä–∞–±–æ—Ç–∫–∞ TON –≤—ã–ø–ª–∞—Ç",
            "description": """
**–î–µ–Ω—å 11-12**

**–ó–∞–¥–∞—á–∏:**
- [ ] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `calculate_monthly_revenue_share.py`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `process_ton_payments_for_period()`:
  - –ü–æ–ª—É—á–∏—Ç—å –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã —Å payment_method='ton'
  - –î–ª—è –∫–∞–∂–¥–æ–π –≤—ã–ø–ª–∞—Ç—ã:
    - –ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏ –µ–≥–æ TON –∫–æ—à–µ–ª–µ–∫
    - –ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å TON/USD
    - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å USD ‚Üí TON
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ TONPaymentService
    - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã –≤ –ë–î
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry –ª–æ–≥–∏–∫–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ TON –≤—ã–ø–ª–∞—Ç
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 2.2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –ë–î",
            "description": """
**–î–µ–Ω—å 11-12**

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ `ton_payments` –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `partner_revenue_share.status` ‚Üí 'paid'
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `ton_tx_hash` –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- [ ] –û–±–µ—Å–ø–µ—á–∏—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –≤—ã–ø–ª–∞—Ç
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 2.3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π",
            "description": """
**–î–µ–Ω—å 13-14**

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `check_pending_ton_transactions()`:
  - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ 'sent' —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
  - –û–±–Ω–æ–≤–∏—Ç—å –¥–æ 'confirmed' –∏–ª–∏ 'failed'
- [ ] –°–æ–∑–¥–∞—Ç—å cron –∑–∞–¥–∞—á—É –∏–ª–∏ background worker
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ failed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            """,
            "priority": 2
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 2.4: Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è failed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π",
            "description": """
**–î–µ–Ω—å 13-14**

**–ó–∞–¥–∞—á–∏:**
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –¥–ª—è failed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –õ–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ retry (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3 –ø–æ–ø—ã—Ç–∫–∏)
- [ ] –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É retry
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö retry –ø–æ–ø—ã—Ç–æ–∫

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
            """,
            "priority": 3  # Medium
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 2.5: API endpoints –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
            "description": """
**–î–µ–Ω—å 15**

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `secure_api.py`:
  - `GET /api/admin/ton-payments` - —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  - `POST /api/admin/ton-payments/{id}/retry` - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
  - `GET /api/admin/ton-statistics` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- [ ] –ó–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ Swagger
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è API

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è TON –≤—ã–ø–ª–∞—Ç–∞–º–∏
            """,
            "priority": 4  # Low
        })
        
        # –§–ê–ó–ê 3: BOT –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø (–ù–µ–¥–µ–ª—è 4)
        tasks.append({
            "title": "–§–ê–ó–ê 3.1: –ö–æ–º–∞–Ω–¥–∞ /setup_wallet",
            "description": """
**–î–µ–Ω—å 16-17**

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `bot.py` –∫–æ–º–∞–Ω–¥—É `/setup_wallet`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∫–æ—à–µ–ª—å–∫–∞
- [ ] Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–æ–π "–û—Ç–∫—Ä—ã—Ç—å Telegram Wallet"
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–∞
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ TONPaymentService
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- [ ] –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–∞—Ä—Ç–Ω–µ—Ä—ã –º–æ–≥—É—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å TON –∫–æ—à–µ–ª–µ–∫ —á–µ—Ä–µ–∑ –±–æ—Ç
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 3.2: –ö–æ–º–∞–Ω–¥—ã /my_wallet –∏ /payment_method",
            "description": """
**–î–µ–Ω—å 16-17**

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `/my_wallet`:
  - –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å
  - –°—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã
  - –¢–µ–∫—É—â–∏–π –º–µ—Ç–æ–¥ –≤—ã–ø–ª–∞—Ç
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `/payment_method`:
  - Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏:
    - üí∞ TON COIN
    - üè¶ Bank Transfer
    - üîÑ Both
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î
  - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ TON –∫–æ—à–µ–ª—å–∫–∞
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 3.3: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ã–ø–ª–∞—Ç–∞—Ö",
            "description": """
**–î–µ–Ω—å 18-19**

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `notify_partner_ton_payment()`:
  - –ö—Ä–∞—Å–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Å—É–º–º–æ–π –≤ TON –∏ USD
  - –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ TON explorer
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
  - –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å" / "–û—Ç–∫—Ä—ã—Ç—å –∫–æ—à–µ–ª–µ–∫"
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–∞—Ä—Ç–Ω–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ã–ø–ª–∞—Ç–∞—Ö
            """,
            "priority": 2
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 3.4: –ü–æ–º–æ—â—å –∏ FAQ",
            "description": """
**–î–µ–Ω—å 18-19**

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/ton_help`
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å FAQ:
  - –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∫–æ—à–µ–ª–µ–∫?
  - –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É?
  - –ö–∞–∫ –æ–±–º–µ–Ω—è—Ç—å TON –Ω–∞ USD?
  - –ö–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å TON?
- [ ] –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–º–æ—â—å –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –ø–æ TON
            """,
            "priority": 3
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 3.5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –º–µ–Ω—é –±–æ—Ç–∞",
            "description": """
**–î–µ–Ω—å 20**

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç "üí∞ TON Wallet" –≤ –º–µ–Ω—é –ø–∞—Ä—Ç–Ω–µ—Ä–∞
- [ ] –ü–æ–¥–º–µ–Ω—é —Å –æ–ø—Ü–∏—è–º–∏:
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ—à–µ–ª–µ–∫
  - –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ—à–µ–ª—å–∫–∞
  - –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –≤—ã–ø–ª–∞—Ç
  - –ü–æ–º–æ—â—å
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UX
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–¥–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ TON —Ñ—É–Ω–∫—Ü–∏—è–º
            """,
            "priority": 2
        })
        
        # –§–ê–ó–ê 4: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (–ù–µ–¥–µ–ª—è 5)
        tasks.append({
            "title": "–§–ê–ó–ê 4.1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
            "description": """
**–î–µ–Ω—å 21-22**

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
- [ ] –ü–∞—Ä—Ç–Ω–µ—Ä –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç TON –∫–æ—à–µ–ª–µ–∫ —á–µ—Ä–µ–∑ –±–æ—Ç
- [ ] –†–∞—Å—á–µ—Ç Revenue Share –∑–∞ –ø–µ—Ä–∏–æ–¥
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ TON –≤—ã–ø–ª–∞—Ç—ã
- [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –ë–î
- [ ] Edge cases –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ü–∏–∫–ª –≤—ã–ø–ª–∞—Ç
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 4.2: –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
            "description": """
**–î–µ–Ω—å 21-22**

**–ó–∞–¥–∞—á–∏:**
- [ ] –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ 100+ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–¥—Ä—è–¥
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è batch –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limiting

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –Ω–∞–≥—Ä—É–∑–∫–∞–º
            """,
            "priority": 2
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 4.3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ batch —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏",
            "description": """
**–î–µ–Ω—å 23-24**

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `send_batch_payments()`:
  - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  - Batch –æ—Ç–ø—Ä–∞–≤–∫–∞
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ TON/USD (5 –º–∏–Ω—É—Ç)
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –ë–î

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—ã–ø–ª–∞—Ç
            """,
            "priority": 3
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 4.4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è",
            "description": """
**–î–µ–Ω—å 25**

**–î–æ–∫—É–º–µ–Ω—Ç—ã:**
- [ ] `TON_INTEGRATION_README.md` - –æ–±–∑–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [ ] `TON_PAYMENT_SERVICE_API.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- [ ] `TON_WALLET_SETUP_GUIDE.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
- [ ] `TON_TROUBLESHOOTING.md` - —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- [ ] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é Telegram Wallet
- [ ] FAQ –ø–æ TON –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
            """,
            "priority": 3
        })
        
        # –§–ê–ó–ê 5: –î–ï–ü–õ–û–ô (–ù–µ–¥–µ–ª—è 6)
        tasks.append({
            "title": "–§–ê–ó–ê 5.1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ production",
            "description": """
**–î–µ–Ω—å 26-27**

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å production TON –∫–æ—à–µ–ª–µ–∫
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Fly.io
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ TON mainnet
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Supabase production
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- [ ] –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ç–æ–≤–æ–µ production –æ–∫—Ä—É–∂–µ–Ω–∏–µ
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 5.2: –î–µ–ø–ª–æ–π –∏ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫",
            "description": """
**–î–µ–Ω—å 28-29**

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–µ–ø–ª–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –Ω–∞ Fly.io
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –í—ã–±—Ä–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
- [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–ø–ª–∞—Ç—É –Ω–∞ –Ω–µ–±–æ–ª—å—à—É—é —Å—É–º–º—É
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ production
            """,
            "priority": 1
        })
        
        tasks.append({
            "title": "–§–ê–ó–ê 5.3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
            "description": """
**–î–µ–Ω—å 30**

**–ó–∞–¥–∞—á–∏:**
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –¥–µ–Ω—å
  - –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  - –í—Ä–µ–º—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  - –û—à–∏–±–∫–∏ –∏ failed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∫–æ—à–µ–ª—å–∫–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã (–Ω–∏–∑–∫–∏–π –±–∞–ª–∞–Ω—Å, –æ—à–∏–±–∫–∏)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- [ ] –û–±—É—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—É —Ä–∞–±–æ—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π
- [ ] –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
            """,
            "priority": 2
        })
        
        return tasks


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    api_key = os.getenv("LINEAR_API_KEY")
    
    if not api_key:
        print("‚ùå –û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω LINEAR_API_KEY")
        print("\n–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á:")
        print("1. –ó–∞–π–¥–∏—Ç–µ –≤ Linear.app")
        print("2. Settings ‚Üí Security & Access ‚Üí Personal API keys")
        print("3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á")
        print("4. –î–æ–±–∞–≤—å—Ç–µ –≤ .env —Ñ–∞–π–ª:")
        print("   LINEAR_API_KEY=lin_api_...")
        print("\n   –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:")
        print("   export LINEAR_API_KEY='lin_api_...'")
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞
    if not api_key.startswith("lin_api_"):
        print("‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: API –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å 'lin_api_'")
        print("   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Personal API Key")
    
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä
    setup = LinearTONCoinSetup(api_key=api_key)
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
    print("üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ Linear:\n")
    teams = setup.get_teams()
    for team in teams:
        print(f"   - {team['name']} (key: {team['key']})")
    print()
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–¥–∞—á
    try:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–∞–Ω–¥—É ENGINE –∏–ª–∏ –ø–µ—Ä–≤—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é
        team_key = None
        for team in teams:
            if team["key"] in ["ENGI", "ENG", "ENGINE"]:
                team_key = team["key"]
                break
        
        setup.setup_ton_coin_project(team_key=team_key)
        print("‚úÖ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–µ–∫—Ç –∏ –∑–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞–Ω—ã –≤ Linear.")
        print("\nüìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:")
        print("   - TON_COIN_MINDMAP_ROADMAP.md")
        print("   - TON_COIN_ROADMAP_VISUAL.md")
        print("   - TON_COIN_INTEGRATION_PLAN.md")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    main()

