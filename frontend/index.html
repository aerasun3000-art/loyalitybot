<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="telegram-web-app-version" content="3.0" />
    <title>LoyalityBot</title>
    <!-- Telegram theme fallbacks for browser preview -->
    <style>
      :root {
        --tg-theme-bg-color: #ffffff;
        --tg-theme-text-color: #1c1c1e;
        --tg-theme-hint-color: #8e8e93;
        --tg-theme-link-color: #007aff;
        --tg-theme-button-color: #007aff;
        --tg-theme-button-text-color: #ffffff;
        --tg-theme-secondary-bg-color: #f2f2f7;
      }
      .dark {
        --tg-theme-bg-color: #1c1c1e;
        --tg-theme-text-color: #ffffff;
        --tg-theme-hint-color: #8e8e93;
        --tg-theme-link-color: #0a84ff;
        --tg-theme-button-color: #0a84ff;
        --tg-theme-button-text-color: #ffffff;
        --tg-theme-secondary-bg-color: #2c2c2e;
      }
    </style>
    <!-- Build: 2025-11-22-NEW-PROJECT-v13 -->
    <script>
      // –ê–ì–†–ï–°–°–ò–í–ù–ê–Ø –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –¥–ª—è Telegram Web App v6.0
      (function() {
        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∫—ç—à–µ–π
        if ('caches' in window) {
          caches.keys().then(function(names) {
            names.forEach(function(name) {
              caches.delete(name)
            })
          })
        }
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
        const currentVersion = 'v13-new-project-fix'
        const storedVersion = sessionStorage.getItem('app_version_v13')
        const needsReload = storedVersion !== currentVersion
        
        // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–µ—Ä—Å–∏—é
        try {
          // –ú–∞—Å—Å–∏–≤ –∫–ª—é—á–µ–π –∏ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
          var keysToKeep = ['loyalitybot-theme', 'selectedCity', 'loyalitybot_onboarding_seen']
          var prefixesToKeep = ['fav_partners_', 'translation_cache_']
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
          var savedData = {}
          for (var i = 0; i < localStorage.length; i++) {
            var key = localStorage.key(i)
            var shouldKeep = keysToKeep.indexOf(key) !== -1
            if (!shouldKeep) {
              for (var j = 0; j < prefixesToKeep.length; j++) {
                if (key.indexOf(prefixesToKeep[j]) === 0) {
                  shouldKeep = true
                  break
                }
              }
            }
            if (shouldKeep) {
              savedData[key] = localStorage.getItem(key)
            }
          }
          
          // –û—á–∏—â–∞–µ–º localStorage
          localStorage.clear()
          
          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
          for (var key in savedData) {
            localStorage.setItem(key, savedData[key])
          }
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–µ—Ä—Å–∏—é –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π sessionStorage
          var savedVersion = sessionStorage.getItem('app_version_v13')
          sessionStorage.clear()
          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏—é —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ reload
          if (savedVersion) {
            sessionStorage.setItem('app_version_v13', savedVersion)
          }
          // –û—á–∏—â–∞–µ–º –≤—Å–µ –∫—ç—à–∏
          if ('caches' in window) {
            caches.keys().then(function(names) {
              names.forEach(function(name) {
                caches.delete(name)
              })
            })
          }
        } catch(e) {}
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏—é –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (needsReload) {
          sessionStorage.setItem('app_version_v13', currentVersion)
          // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ Telegram Web App
          if (window.Telegram?.WebApp) {
            setTimeout(function() {
              var url = window.location.href.split('?')[0]
              window.location.href = url + '?v=' + Date.now() + '&_reload=1&_v12=1&_buttons_removed=1&_nocache=' + Date.now()
            }, 100)
          }
        }
      })()
    </script>
    
    <script>
      // –†–∞–Ω–Ω–µ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Ç–µ–º—ã (–¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ React) ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ–ª—É—é –≤—Å–ø—ã—à–∫—É
      // –¢–∞–∫–∂–µ —Å—Ç–∞–≤–∏–º inline-—Å—Ç–∏–ª–∏ —á—Ç–æ–±—ã –ø–µ—Ä–µ–±–∏—Ç—å Telegram SDK
      try {
        var t = JSON.parse(localStorage.getItem('loyalitybot-theme') || '{}')
        if (t && t.state && t.state.theme === 'dark') {
          document.documentElement.className = 'dark'
          var dv = {'--tg-theme-bg-color':'#1B0C1A','--tg-theme-text-color':'#ffffff','--tg-theme-hint-color':'#A090A3','--tg-theme-link-color':'#D4899B','--tg-theme-button-color':'#D4899B','--tg-theme-button-text-color':'#ffffff','--tg-theme-secondary-bg-color':'#2D222F'}
          for (var k in dv) document.documentElement.style.setProperty(k, dv[k])
        } else if (t && t.state && t.state.theme) {
          document.documentElement.className = t.state.theme
        }
      } catch(e) {}
    </script>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
      // Dev mock: ?dev=1 –Ω–∞ localhost ‚Äî –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤
      (function() {
        const isLocalhost = /^https?:\/\/(localhost|127\.0\.0\.1)(:\d+)?(\/|$)/.test(window.location.href)
        const hasDevParam = window.location.search.includes('dev=1')
        if (isLocalhost && hasDevParam && window.Telegram?.WebApp) {
          if (!window.Telegram.WebApp.initDataUnsafe?.user) {
            window.Telegram.WebApp.initDataUnsafe = window.Telegram.WebApp.initDataUnsafe || {}
            window.Telegram.WebApp.initDataUnsafe.user = {
              id: 123456789,
              first_name: 'Test',
              username: 'testuser'
            }
            console.log('üß™ Dev mock: test user injected for referral block testing')
          }
        }
      })()
    </script>
  </head>
  <body>
    <div id="root">
      <div style="padding: 20px; text-align: center; font-family: system-ui;">
        <h1>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</h1>
        <p>–ï—Å–ª–∏ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –∏—Å—á–µ–∑–ª–æ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)</p>
      </div>
    </div>
    <script>
      // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
      console.log('‚úÖ HTML –∑–∞–≥—Ä—É–∂–µ–Ω')
      console.log('‚úÖ Root element:', document.getElementById('root'))
      console.log('‚úÖ Telegram WebApp SDK:', typeof window.Telegram !== 'undefined' ? '–∑–∞–≥—Ä—É–∂–µ–Ω' : '–Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω')
    </script>
    <script type="module" src="/src/main.jsx"></script>
    <script>
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è
      setTimeout(() => {
        const root = document.getElementById('root')
        if (root && root.children.length === 1 && root.children[0].textContent.includes('–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è')) {
          console.error('‚ùå React –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∫–ª–∞–¥–∫—É Network –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤.')
          root.innerHTML = `
            <div style="padding: 20px; text-align: center; font-family: system-ui;">
              <h1 style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h1>
              <p>React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å.</p>
              <p style="color: #666; font-size: 14px; margin-top: 20px;">
                –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∫–ª–∞–¥–∫—É Network –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫.
              </p>
              <button onclick="window.location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">
                –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
              </button>
            </div>
          `
        }
      }, 3000)
    </script>
  </body>
</html>
