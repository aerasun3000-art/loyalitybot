# üß™ –ü–û–î–†–û–ë–ù–û–ï –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ –ú–£–õ–¨–¢–ò–í–ê–õ–Æ–¢–ù–û–°–¢–ò

**–î–∞—Ç–∞:** –î–µ–∫–∞–±—Ä—å 2025  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–∞–ª—é—Ç–∞–º–∏

---

## üìã –ü–û–î–ì–û–¢–û–í–ö–ê –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

1. **–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:**
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—è currency
   SELECT column_name, data_type 
   FROM information_schema.columns 
   WHERE table_name = 'transactions' AND column_name = 'currency';
   
   -- –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å: currency | text
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç:**
   ```sql
   SELECT from_currency, to_currency, rate 
   FROM currency_exchange_rates 
   WHERE to_currency = 'USD';
   ```
   
   **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   ```
   VND | USD | 0.0000408
   RUB | USD | 0.011
   KZT | USD | 0.0021
   KGS | USD | 0.011
   AED | USD | 0.272
   ```

3. **–ù–∞–π—Ç–∏ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞:**
   - –ù—É–∂–µ–Ω –ø–∞—Ä—Ç–Ω–µ—Ä —Å `city = 'Nha Trang'` –≤ —Ç–∞–±–ª–∏—Ü–µ `partners`
   - –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î

---

## üß™ –¢–ï–°–¢ 1: –°–û–ó–î–ê–ù–ò–ï –¢–†–ê–ù–ó–ê–ö–¶–ò–ò –° –í–ê–õ–Æ–¢–û–ô VND

### –®–∞–≥ 1.1: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞

**–ï—Å–ª–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ SQL:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –ø–∞—Ä—Ç–Ω–µ—Ä –∏–∑ –ù—è—á–∞–Ω–≥–∞
SELECT chat_id, name, company_name, city 
FROM partners 
WHERE city = 'Nha Trang' 
LIMIT 1;

-- –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ (–∑–∞–º–µ–Ω–∏—Ç–µ CHAT_ID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π)
INSERT INTO partners (chat_id, name, company_name, city, district)
VALUES ('123456789', 'Test Partner Nha Trang', 'MBAR Test', 'Nha Trang', 'All')
ON CONFLICT (chat_id) DO UPDATE SET city = 'Nha Trang';
```

**–ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞:**
- –û—Ç–∫—Ä—ã—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞
- –í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥: **"Nha Trang"**
- –ó–∞–ø–æ–ª–Ω–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –∏ –æ–¥–æ–±—Ä–∏—Ç—å —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–±–æ—Ç–∞

---

### –®–∞–≥ 1.2: –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —á–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –±–æ—Ç

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç (–ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π)**

1. –û—Ç–∫—Ä—ã—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –±–æ—Ç –≤ Telegram
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/start` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è)
3. –ù–∞–π—Ç–∏ –º–µ–Ω—é "‚ûï –ù–∞—á–∏—Å–ª–∏—Ç—å –±–∞–ª–ª—ã" –∏–ª–∏ "–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é"
4. –í–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ:
   - **Chat ID –∫–ª–∏–µ–Ω—Ç–∞:** (–ª—é–±–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª–∏–µ–Ω—Ç, –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ)
   - **–°—É–º–º–∞ —á–µ–∫–∞:** `500000` (–≤ –¥–æ–Ω–≥–∞—Ö)
   - **–û–ø–∏—Å–∞–Ω–∏–µ:** "–¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è VND"
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ API –∏–ª–∏ –ø—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ë–î (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞)**

```sql
-- –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞–ø—Ä—è–º—É—é
-- –ó–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ:
-- - partner_chat_id: chat_id –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –ù—è—á–∞–Ω–≥–∞
-- - client_chat_id: chat_id –ª—é–±–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

INSERT INTO transactions (
    client_chat_id,
    partner_chat_id,
    total_amount,
    currency,  -- ‚úÖ –í–ê–ñ–ù–û: –≤–∞–ª—é—Ç–∞ –¥–æ–ª–∂–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    earned_points,
    spent_points,
    operation_type,
    description,
    date_time
) VALUES (
    '999888777',  -- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π client_chat_id
    '123456789',  -- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ chat_id –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –ù—è—á–∞–Ω–≥–∞
    500000,       -- –°—É–º–º–∞ –≤ –¥–æ–Ω–≥–∞—Ö
    'VND',        -- –í–∞–ª—é—Ç–∞ (–µ—Å–ª–∏ record_transaction —Ä–∞–±–æ—Ç–∞–µ—Ç - –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    25000,        -- –ë–∞–ª–ª—ã (5% –æ—Ç 500000 = 25000)
    0,
    'accrual',
    '–¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è VND –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç–∏',
    NOW()
);
```

**–í–∞—Ä–∏–∞–Ω—Ç C: –ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç (–µ—Å–ª–∏ –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω)**

```python
# test_transaction.py
from supabase_manager import SupabaseManager

sm = SupabaseManager()

# –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
result = sm.execute_transaction(
    client_chat_id=999888777,  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π
    partner_chat_id='123456789',  # –ü–∞—Ä—Ç–Ω–µ—Ä –∏–∑ –ù—è—á–∞–Ω–≥–∞
    txn_type='accrual',
    raw_amount=500000.0  # 500,000 –¥–æ–Ω–≥–æ–≤
)

print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç: {result}")
```

---

### –®–∞–≥ 1.3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Supabase, —á—Ç–æ –≤–∞–ª—é—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
SELECT 
    id,
    client_chat_id,
    partner_chat_id,
    total_amount,
    currency,  -- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç–æ –ø–æ–ª–µ
    earned_points,
    operation_type,
    description,
    date_time
FROM transactions
ORDER BY id DESC
LIMIT 1;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
id: 12345
partner_chat_id: 123456789
total_amount: 500000
currency: VND  ‚úÖ –î–û–õ–ñ–ù–û –ë–´–¢–¨ 'VND'
earned_points: 25000
```

**–ï—Å–ª–∏ `currency = NULL` –∏–ª–∏ `currency = 'USD'`:**
- ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `record_transaction()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞ –Ω–∞ –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∞—Ä—Ç–Ω–µ—Ä –∏–º–µ–µ—Ç `city = 'Nha Trang'` –≤ –ë–î

---

### –®–∞–≥ 1.4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–∞–ª—é—Ç–∞–º–∏

**–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤:**

```sql
-- 1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –ù—è—á–∞–Ω–≥–∞ (VND)
-- (—É–∂–µ —Å–æ–∑–¥–∞–ª–∏ –≤—ã—à–µ)

-- 2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ NY (USD)
-- –ù–∞–π–¥–∏—Ç–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Å city = 'New York'
INSERT INTO transactions (
    client_chat_id, partner_chat_id, total_amount, currency,
    earned_points, operation_type, description, date_time
) VALUES (
    '999888777', '987654321', 100, 'USD',  -- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ ID
    5, 'accrual', '–¢–µ—Å—Ç USD', NOW()
);

-- 3. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –ê–ª–º–∞—Ç—ã (KZT)
-- –ù–∞–π–¥–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Å city = 'Almaty'
INSERT INTO transactions (
    client_chat_id, partner_chat_id, total_amount, currency,
    earned_points, operation_type, description, date_time
) VALUES (
    '999888777', '111222333', 10000, 'KZT',  -- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ ID
    50, 'accrual', '–¢–µ—Å—Ç KZT', NOW()
);
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –≤–∞–ª—é—Ç—ã:**
```sql
SELECT currency, COUNT(*) as count, 
       SUM(total_amount) as total_sum
FROM transactions
WHERE currency IS NOT NULL
GROUP BY currency
ORDER BY count DESC;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
currency | count | total_sum
---------|-------|----------
USD      | X     | ...
VND      | 1     | 500000
KZT      | 1     | 10000
```

---

## üß™ –¢–ï–°–¢ 2: –ü–†–û–í–ï–†–ö–ê –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø –ù–ê –§–†–û–ù–¢–ï–ù–î–ï

### –®–∞–≥ 2.1: –û—Ç–∫—Ä—ã—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É

**–î–µ–π—Å—Ç–≤–∏—è:**

1. **–ù–∞–π—Ç–∏ Chat ID –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –ù—è—á–∞–Ω–≥–∞:**
   ```sql
   SELECT chat_id, name, city 
   FROM partners 
   WHERE city = 'Nha Trang';
   ```
   
   **–ò–ª–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–±–æ—Ç–∞:**
   - –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–±–æ—Ç
   - –ö–æ–º–∞–Ω–¥–∞ `/list_partners` –∏–ª–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
   - –ù–∞–π—Ç–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Å `city = 'Nha Trang'`
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ `chat_id`

2. **–û—Ç–∫—Ä—ã—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:**
   - **URL:** `https://your-frontend.netlify.app/partner/analytics?partner_id=123456789`
     - –ó–∞–º–µ–Ω–∏—Ç–µ `123456789` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π `chat_id` –ø–∞—Ä—Ç–Ω–µ—Ä–∞
   - **–ò–ª–∏ —á–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –±–æ—Ç:**
     - –û—Ç–∫—Ä—ã—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –±–æ—Ç –≤ Telegram
     - –ù–∞–π—Ç–∏ –∫–Ω–æ–ø–∫—É "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" –∏–ª–∏ "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞"
     - –ö–ª–∏–∫–Ω—É—Ç—å - –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π

3. **–ì–¥–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   
   **–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ "üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏":**
   
   ```
   üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ üíµ –û–±—â–∏–π –æ–±–æ—Ä–æ—Ç                                 ‚îÇ
   ‚îÇ [–ó–î–ï–°–¨ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—É–º–º–∞ —Å —Å–∏–º–≤–æ–ª–æ–º –≤–∞–ª—é—Ç—ã]     ‚îÇ
   ‚îÇ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: [–ò –∑–¥–µ—Å—å —Ç–æ–∂–µ]                     ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ```
   
   **–ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —ç—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç** (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏):
   ```751:752:frontend/src/pages/PartnerAnalytics.jsx
   value={formatCurrencySimple(stats.totalRevenue, partnerCity)}
   subtitle={`–°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ${formatCurrencySimple(stats.avgCheck, partnerCity)}`}
   ```

   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   ```
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  üìä –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞                               ‚îÇ
   ‚îÇ  –§–∏–ª—å—Ç—Ä—ã: [7 –¥–Ω–µ–π] [30 –¥–Ω–µ–π] [90 –¥–Ω–µ–π] [–ì–æ–¥]          ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ  üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏                               ‚îÇ
   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
   ‚îÇ  ‚îÇ üíµ –û–±—â–∏–π     ‚îÇ  ‚îÇ üßæ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏‚îÇ  ‚îÇ üíé –ë–∞–ª–ª—ã     ‚îÇ ‚îÇ
   ‚îÇ  ‚îÇ –æ–±–æ—Ä–æ—Ç       ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ ‚îÇ
   ‚îÇ  ‚îÇ [‚Ç´500,000] ‚Üê ‚îÇ  ‚îÇ [123 —à—Ç]     ‚îÇ  ‚îÇ [25,000]     ‚îÇ ‚îÇ
   ‚îÇ  ‚îÇ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ‚îÇ  ‚îÇ ...          ‚îÇ  ‚îÇ ...          ‚îÇ ‚îÇ
   ‚îÇ  ‚îÇ [‚Ç´250,000] ‚Üê ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ ‚îÇ
   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
   ‚îÇ            ‚Üë                                            ‚îÇ
   ‚îÇ      –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∑–¥–µ—Å—å!                                   ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ  üë• –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –±–∞–∑–∞                                     ‚îÇ
   ‚îÇ  ...                                                    ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ  ‚≠ê NPS –∏–Ω–¥–µ–∫—Å                                          ‚îÇ
   ‚îÇ  ...                                                    ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ```

4. **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:**
   - ‚úÖ **–û–±—â–∏–π –æ–±–æ—Ä–æ—Ç:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å —Å–∏–º–≤–æ–ª–æ–º ‚Ç´ (VND)
     - **–ü—Ä–∏–º–µ—Ä:** `‚Ç´500,000` –∏–ª–∏ `500.000‚Ç´`
   - ‚úÖ **–°—Ä–µ–¥–Ω–∏–π —á–µ–∫:** —Ç–∞–∫–∂–µ —Å —Å–∏–º–≤–æ–ª–æ–º ‚Ç´
     - **–ü—Ä–∏–º–µ—Ä:** `‚Ç´250,000`
   - ‚úÖ **–ë–µ–∑ –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤** (—Ç–æ–ª—å–∫–æ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞ –¥–ª—è VND, KZT, KGS)
   - ‚úÖ –§–æ—Ä–º–∞—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è —Ç—ã—Å—è—á: –ø—Ä–æ–±–µ–ª –∏–ª–∏ –∑–∞–ø—è—Ç–∞—è

---

### –®–∞–≥ 2.2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã

**–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

| –í–∞–ª—é—Ç–∞ | –ì–æ—Ä–æ–¥ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ | –û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä |
|--------|----------------|------------------|--------|
| **VND** | Nha Trang | `‚Ç´500,000` –∏–ª–∏ `500.000‚Ç´` | `‚Ç´500,000` |
| **USD** | New York | `$100` | `$100` |
| **RUB** | –ú–æ—Å–∫–≤–∞ | `‚ÇΩ3,000` | `‚ÇΩ3,000` |
| **KZT** | Almaty | `‚Ç∏10,000` | `‚Ç∏10,000` |
| **KGS** | Bishkek | `1,000 —Å–æ–º` | `1,000 —Å–æ–º` |
| **AED** | Dubai | `ÿØ.ÿ•100` –∏–ª–∏ `100 ÿØ.ÿ•` | `100 ÿØ.ÿ•` (RTL) |

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. **–û—Ç–∫—Ä—ã—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞:**
   ```
   https://your-frontend.netlify.app/partner/analytics?partner_id={PARTNER_CHAT_ID}
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã:**
   - ‚úÖ **–û–±—â–∏–π –æ–±–æ—Ä–æ—Ç (Total Revenue)** - –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å —Å–∏–º–≤–æ–ª–æ–º –≤–∞–ª—é—Ç—ã
   - ‚úÖ **–°—Ä–µ–¥–Ω–∏–π —á–µ–∫ (Average Check)** - –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å —Å–∏–º–≤–æ–ª–æ–º –≤–∞–ª—é—Ç—ã
   - ‚úÖ **–¢–∞–±–ª–∏—Ü–∞ –≤ AdminAnalytics** (–µ—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –∞–¥–º–∏–Ω–∫—É) - –∫–æ–ª–æ–Ω–∫–∞ "–û–±–æ—Ä–æ—Ç" –¥–æ–ª–∂–Ω–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –≤–∞–ª—é—Ç–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
   - ‚úÖ **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ History.jsx** - —Å—É–º–º—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å —Å–∏–º–≤–æ–ª–æ–º –≤–∞–ª—é—Ç—ã
   - ‚úÖ **Revenue Share —Å—É–º–º—ã** (–µ—Å–ª–∏ –µ—Å—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ) - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ USD

3. **–°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã** –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

### –®–∞–≥ 2.3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

**–î–µ–π—Å—Ç–≤–∏—è:**

1. **–û—Ç–∫—Ä—ã—Ç—å DevTools:**
   - Windows/Linux: `F12` –∏–ª–∏ `Ctrl+Shift+I`
   - Mac: `Cmd+Option+I`
   - –ò–ª–∏ –∫–ª–∏–∫–Ω—É—Ç—å –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π ‚Üí "Inspect" / "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–¥"

2. **–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console:**
   - –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Console** –≤ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ DevTools

3. **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**
   - –ù–∞–∂–∞—Ç—å `F5` –∏–ª–∏ `Cmd+R` (Mac) / `Ctrl+R` (Windows)

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏:**
   
   **–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–æ–≥:**
   ```
   [PartnerAnalytics] Partner info loaded: {chat_id: "...", name: "...", city: "Nha Trang", ...}
   ```
   
   **–ï—Å–ª–∏ `city` –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω:**
   ```
   [PartnerAnalytics] Partner info loaded: {chat_id: "...", name: "...", city: null, ...}
   ```
   - ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞—Ä—Ç–Ω–µ—Ä –Ω–µ –∏–º–µ–µ—Ç –ø–æ–ª—è `city` –≤ –ë–î
   - **–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç—å `city` –≤ —Ç–∞–±–ª–∏—Ü–µ `partners`

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫:**
   - ‚ùå `Cannot read property 'city' of undefined`
     - **–ü—Ä–∏—á–∏–Ω–∞:** `partnerInfo` –ø—É—Å—Ç–æ–π –∏–ª–∏ `null`
   - ‚ùå `formatCurrency is not a function`
     - **–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–ª–∏ –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ `currency.js`
   - ‚ùå `getCurrencyByCity is not defined`
     - **–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ `currency.js`
   - ‚ùå `TypeError: Cannot read properties of null`
     - **–ü—Ä–∏—á–∏–Ω–∞:** `partnerCity` —Ä–∞–≤–µ–Ω `null`, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `formatCurrencySimple()`

6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Network**
   - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
   - –ù–∞–π—Ç–∏ –∑–∞–ø—Ä–æ—Å –∫ Supabase (—Ñ–∏–ª—å—Ç—Ä: `supabase` –∏–ª–∏ `transactions`)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω—É–ª –¥–∞–Ω–Ω—ã–µ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–µ `currency` –≤ –æ—Ç–≤–µ—Ç–µ

**–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ `PartnerAnalytics.jsx`:
  ```javascript
  import { formatCurrencySimple } from '../utils/currency';
  ```
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `currency.js` –æ–±–Ω–æ–≤–ª–µ–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–æ–≤—ã–µ –≤–∞–ª—é—Ç—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∞—Ä—Ç–Ω–µ—Ä –∏–º–µ–µ—Ç –ø–æ–ª–µ `city` –≤ –ë–î

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å:**

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ partnerCity —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
console.log('Partner City:', document.querySelector('[data-testid="partner-city"]')?.textContent);

// –ò–ª–∏ —á–µ—Ä–µ–∑ React DevTools (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
// –ù–∞–π—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç PartnerAnalytics ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å state: partnerCity
```

---

### –®–∞–≥ 2.4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –û—Ç–∫—Ä—ã—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏–ª–∏ —á–µ—Ä–µ–∑ DevTools (Device Mode)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–∏–º–≤–æ–ª—ã –≤–∞–ª—é—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üß™ –¢–ï–°–¢ 3: –ü–†–û–í–ï–†–ö–ê –†–ê–°–ß–ï–¢–ê REVENUE SHARE

### –®–∞–≥ 3.1: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –≤–∞–ª—é—Ç–∞—Ö

```sql
-- –ü–∞—Ä—Ç–Ω–µ—Ä A (–ù—è—á–∞–Ω–≥, VND): 2 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
-- –ü–∞—Ä—Ç–Ω–µ—Ä B (NY, USD): 2 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ A (VND)
INSERT INTO transactions (client_chat_id, partner_chat_id, total_amount, currency, earned_points, operation_type, date_time)
VALUES 
    ('111', 'PARTNER_A_ID', 500000, 'VND', 25000, 'accrual', NOW() - INTERVAL '2 days'),
    ('222', 'PARTNER_A_ID', 300000, 'VND', 15000, 'accrual', NOW() - INTERVAL '1 day');

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ B (USD)
INSERT INTO transactions (client_chat_id, partner_chat_id, total_amount, currency, earned_points, operation_type, date_time)
VALUES 
    ('333', 'PARTNER_B_ID', 100, 'USD', 5, 'accrual', NOW() - INTERVAL '2 days'),
    ('444', 'PARTNER_B_ID', 200, 'USD', 10, 'accrual', NOW() - INTERVAL '1 day');
```

---

### –®–∞–≥ 3.2: –†–∞—Å—Å—á–∏—Ç–∞—Ç—å Revenue Share

**–ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç:**
```python
from partner_revenue_share import PartnerRevenueShare
from supabase_manager import SupabaseManager
from datetime import date, timedelta

sm = SupabaseManager()
revenue_share = PartnerRevenueShare(sm)

# –†–∞—Å—á–µ—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
period_end = date.today()
period_start = period_end - timedelta(days=7)

result = revenue_share.process_revenue_share_for_period(period_start, period_end)
print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç: {result}")
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–±–æ—Ç–∞** (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞)

---

### –®–∞–≥ 3.3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Revenue Share –∑–∞–ø–∏—Å–∏
SELECT 
    partner_chat_id,
    source_partner_chat_id,
    system_revenue,  -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ USD
    calculated_amount,
    final_amount,
    period_start,
    period_end
FROM partner_revenue_share
ORDER BY created_at DESC
LIMIT 10;
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `system_revenue` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ USD (–Ω–µ —Å–º–µ—à–∞–Ω–Ω—ã–µ –≤–∞–ª—é—Ç—ã)
- ‚úÖ –î–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ A (VND): –æ–±–æ—Ä–æ—Ç 800,000 VND ‚Üí ~$32.64 USD (500,000 + 300,000 √ó 0.0000408)
- ‚úÖ –î–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ B (USD): –æ–±–æ—Ä–æ—Ç $300 USD ‚Üí $300 USD

---

## üß™ –¢–ï–°–¢ 4: –ü–†–û–í–ï–†–ö–ê –†–ï–§–ï–†–ê–õ–¨–ù–´–• –ö–û–ú–ò–°–°–ò–ô

### –®–∞–≥ 4.1: –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–º

1. **–ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–æ–π:**
   ```sql
   -- –ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ —Å referral_source
   SELECT chat_id, referral_source 
   FROM users 
   WHERE referral_source IS NOT NULL 
   LIMIT 1;
   ```

2. **–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:**
   - –ß–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –±–æ—Ç
   - –ò–ª–∏ —á–µ—Ä–µ–∑ SQL (–∫–∞–∫ –≤ –¢–µ—Å—Ç–µ 1)

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã:**
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–º–∏—Å—Å–∏–π
   SELECT 
       client_chat_id,
       operation_type,
       description,
       total_amount,
       earned_points
   FROM transactions
   WHERE description LIKE '%—Ä–µ—Ñ–µ—Ä–∞–ª%' OR description LIKE '%referral%'
   ORDER BY date_time DESC
   LIMIT 10;
   ```

---

### –®–∞–≥ 4.2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –≤–∞–ª—é—Ç –≤ –∫–æ–º–∏—Å—Å–∏—è—Ö

**–õ–æ–≥–∏–∫–∞:**
- –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ VND ‚Üí –∫–æ–º–∏—Å—Å–∏–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –æ—Ç —Å—É–º–º—ã –≤ USD
- –ü—Ä–∏–º–µ—Ä: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 500,000 VND = $20.40 USD ‚Üí –∫–æ–º–∏—Å—Å–∏—è L1 = $20.40 √ó 5% = $1.02

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö –±–æ—Ç–∞:**
- –ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É: `"–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏: 500000 VND ‚Üí 20.40 USD"`

---

## üìä –ß–ï–ö–õ–ò–°–¢ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- [ ] –ü–æ–ª–µ `currency` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É `transactions`
- [ ] –¢–∞–±–ª–∏—Ü–∞ `currency_exchange_rates` —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
- [ ] –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–ª—è –≤—Å–µ—Ö –≤–∞–ª—é—Ç

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

- [ ] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –ù—è—á–∞–Ω–≥–∞ ‚Üí `currency = 'VND'` ‚úÖ
- [ ] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ NY ‚Üí `currency = 'USD'` ‚úÖ
- [ ] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –ê–ª–º–∞—Ç—ã ‚Üí `currency = 'KZT'` ‚úÖ
- [ ] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –±–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ ‚Üí `currency = 'USD'` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

- [ ] VND —Å—É–º–º—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ `‚Ç´500,000` ‚úÖ
- [ ] USD —Å—É–º–º—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ `$100` ‚úÖ
- [ ] KZT —Å—É–º–º—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ `‚Ç∏10,000` ‚úÖ
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

### –†–∞—Å—á–µ—Ç—ã –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π

- [ ] Revenue Share —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ USD –¥–ª—è –≤—Å–µ—Ö –≤–∞–ª—é—Ç ‚úÖ
- [ ] –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ USD ‚úÖ
- [ ] –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (VND ‚Üí USD)

---

## üêõ –ß–ê–°–¢–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ 1: `currency = NULL` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–∞—Ä—Ç–Ω–µ—Ä –Ω–µ –∏–º–µ–µ—Ç –ø–æ–ª—è `city` –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –±–µ–∑ –≥–æ—Ä–æ–¥–∞
SELECT chat_id, name, city 
FROM partners 
WHERE city IS NULL OR city = '';

-- –û–±–Ω–æ–≤–∏—Ç—å –≥–æ—Ä–æ–¥
UPDATE partners 
SET city = 'Nha Trang' 
WHERE chat_id = 'PARTNER_ID';
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –°—É–º–º—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–µ –≤ —Ç–æ–π –≤–∞–ª—é—Ç–µ

**–ü—Ä–∏—á–∏–Ω–∞:** `partnerCity` –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `getPartnerInfo(partnerId)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `city`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `formatCurrency(value, partnerCity)` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Revenue Share –Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ USD

**–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è `convert_currency()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `supabase_client` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `convert_currency()`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—É—Ä—Å—ã –≤ –ë–î: `SELECT * FROM currency_exchange_rates;`

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–®–ù–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–º, –µ—Å–ª–∏:

1. ‚úÖ –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –≤–∞–ª—é—Ç—É –≤ –ë–î
2. ‚úÖ –°—É–º–º—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –≤–∞–ª—é—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
3. ‚úÖ Revenue Share —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ USD (–Ω–µ —Å–º–µ—à–∞–Ω–Ω—ã–µ –≤–∞–ª—é—Ç—ã)
4. ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ USD
5. ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
6. ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö –±–æ—Ç–∞

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** –î–µ–∫–∞–±—Ä—å 2025  
**–í–µ—Ä—Å–∏—è:** 1.0
