# üìù –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Sentry Webhook

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± (5 –º–∏–Ω—É—Ç)

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Sentry Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://sentry.io/
2. –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π)

**URL –ø—Ä–æ–µ–∫—Ç–∞ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:**
```
https://sentry.io/organizations/YOUR-ORG/projects/YOUR-PROJECT/
```

–ó–∞–ø–æ–º–Ω–∏—Ç–µ:
- `YOUR-ORG` - —ç—Ç–æ Organization Slug
- `YOUR-PROJECT` - —ç—Ç–æ Project Slug (–æ–±—ã—á–Ω–æ "python")

---

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Webhook Integration

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –Ω–∞–∂–º–∏—Ç–µ **‚öôÔ∏è Settings**
2. –í –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **Integrations**
3. –ù–∞–π–¥–∏—Ç–µ **Webhooks** –≤ —Å–ø–∏—Å–∫–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
4. –ù–∞–∂–º–∏—Ç–µ **Configure** –∏–ª–∏ **Add to Project**

---

### –®–∞–≥ 3: –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É Webhook

**Callback URL:**
```
https://your-domain.com/api/sentry-webhook
```

**–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok):**
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
ngrok http 8003

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ HTTPS URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://abc123.ngrok.io)
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: https://abc123.ngrok.io/api/sentry-webhook
```

**Secret (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `.env`:
  ```bash
  grep SENTRY_WEBHOOK_SECRET .env
  ```
- –ò–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º

5. –ù–∞–∂–º–∏—Ç–µ **Save Changes**

---

### –®–∞–≥ 4: –°–æ–∑–¥–∞–π—Ç–µ Alert Rule

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **Alerts**
2. –ù–∞–∂–º–∏—Ç–µ **Create Alert** (–∏–ª–∏ **+ Create Alert Rule**)
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: **Issues**

**–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É—Å–ª–æ–≤–∏—è (When):**
- ‚úÖ –û—Ç–º–µ—Ç—å—Ç–µ: **"An issue is first seen"**
- ‚úÖ –û—Ç–º–µ—Ç—å—Ç–µ: **"An issue changes state from resolved to unresolved"**
- ‚úÖ –û—Ç–º–µ—Ç—å—Ç–µ: **"The issue is seen more than 10 times in 1 minute"** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è (Then):**
- –í —Ä–∞–∑–¥–µ–ª–µ **"Then perform these actions"**
- –í—ã–±–µ—Ä–∏—Ç–µ **"Send a notification via Webhooks"**
- –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π webhook –∏–∑ —Å–ø–∏—Å–∫–∞

4. –ù–∞–∂–º–∏—Ç–µ **Save Alert Rule**

---

### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ API (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

```bash
# –í—ã–∑–æ–≤–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –æ—à–∏–±–∫—É
curl http://127.0.0.1:8003/sentry-debug

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
# 1. Sentry Dashboard ‚Üí Issues - –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞
# 2. Telegram - –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ Sentry UI

1. –í Sentry Dashboard ‚Üí **Settings** ‚Üí **Integrations** ‚Üí **Webhooks**
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à webhook
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Test"** –∏–ª–∏ **"Send Test"**
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook endpoint

```bash
curl -X POST http://127.0.0.1:8003/api/sentry-webhook \
  -H "Content-Type: application/json" \
  -d '{"test": "data"}'

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
# {"status":"ok","message":"Alert sent to Telegram"}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram

- –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
- –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ (—Ç–æ–∫–µ–Ω: `8167568746:AAFQJ4ovbbvvDPBzuDjsC33KRirLgQ6MNBM`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–∏—Ö–æ–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ secure_api
tail -f logs/secure_api.log

# –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ webhook
```

---

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Webhook –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL:**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
   - –î–ª—è —Ç–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok
   - –§–æ—Ä–º–∞—Ç: `https://domain.com/api/sentry-webhook`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:**
   ```bash
   curl http://127.0.0.1:8003/health
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   tail -f logs/secure_api.log
   ```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
   ```bash
   grep SENTRY_ALERT .env
   ```
   –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
   - `SENTRY_ALERT_TELEGRAM_TOKEN=8167568746:AAFQJ4ovbbvvDPBzuDjsC33KRirLgQ6MNBM`
   - `SENTRY_ALERT_CHAT_ID=406631153`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω:**
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –≤—Ä—É—á–Ω—É—é:**
   ```bash
   curl -X POST "https://api.telegram.org/bot8167568746:AAFQJ4ovbbvvDPBzuDjsC33KRirLgQ6MNBM/sendMessage" \
     -d "chat_id=406631153&text=Test message"
   ```

### –û—à–∏–±–∫–∞ 401 (Invalid signature)

- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `SENTRY_WEBHOOK_SECRET` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤ Sentry –∏ `.env`
- –ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É (–æ—Å—Ç–∞–≤—å—Ç–µ Secret –ø—É—Å—Ç—ã–º –≤ Sentry)

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ Telegram!

**–§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
```
‚ùå SENTRY ALERT

ERROR: ZeroDivisionError: division by zero

üìç Location: secure_api.py:155 in trigger_error

üåç Environment: production
üì¶ Release: loyaltybot@1.0.0

üîó View in Sentry
```

---

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å

- –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `SETUP_SENTRY_WEBHOOKS.md`
- –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `QUICK_WEBHOOK_SETUP.md`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞: `setup_webhook_interactive.py`


