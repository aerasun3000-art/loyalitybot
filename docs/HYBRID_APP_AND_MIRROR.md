# Гибридное приложение и зеркало (сайт / PWA / версия для РФ)

## Суть

Один и тот же фронтенд может работать в двух режимах входа:

1. **Telegram Mini App** — пользователь открывает приложение из бота (внутри Telegram).
2. **Сайт / PWA** — пользователь открывает тот же URL в браузере или с иконки на рабочем столе (гибрид «как сайт»).

Авторизация везде остаётся **через Telegram**: либо по `initData` (в боте), либо по одноразовой ссылке с `tg_auth` (кнопка «Открыть в браузере»). Отдельного логина/пароля для сайта нет.

---

## Реализация гибрида (Mini App + сайт)

### Что уже есть в проекте

- Проверки вида `window.Telegram?.WebApp`, `tg?.initDataUnsafe?.user` — при открытии в браузере Telegram отсутствует, код не падает.
- **AuthBootstrap**: если есть `initData` — считаем пользователя из Telegram; если нет, но есть `tg_auth` в URL — верификация через API, сохранение `chat_id` в sessionStorage.
- **telegram.js**: `getChatId()` / `getTelegramUser()` возвращают данные из `initData` или из сохранённого `chat_id` (после проверки `tg_auth`).
- Кнопки Telegram (MainButton, BackButton, showAlert) вызываются только при наличии `tg` — в браузере просто не показываются.

### Что добавить для «иконки на рабочий стол»

- **PWA**: `manifest.webmanifest` (название, иконки 192×192 и 512×512, `display: "standalone"`), ссылка на манифест в `index.html`.
- По желанию — минимальный Service Worker для возможности «Установить приложение» в браузере.

Конфликта между режимами нет: один код, один деплой; разница только в наличии `window.Telegram` и в способе получения `chat_id`.

---

## Зеркало для России (обход ограничений)

Идея: тот же фронт (и при необходимости тот же или свой бэкенд) развернуть на **российском хостинге** под отдельным доменом — чтобы пользователи из РФ могли заходить при блокировках основного домена.

### Технически

- **Один репозиторий, один код** — отдельной «версии для России» в коде не нужно.
- **Два (или больше) деплоя**:
  - основной: например Cloudflare Pages + API на Cloudflare Workers;
  - зеркало для РФ: тот же билд фронта на российском хостинге (VK Cloud, Selectel, Timeweb и т.д.), свой домен (например `app-ru.example.com` или домен в зоне .ru).
- **Переменные окружения** для билда зеркала:
  - `VITE_API_URL` — URL API (общий или свой инстанс API на российском хостинге).
- **Бот**:
  - можно оставить одну Web App URL (основной домен);
  - зеркало использовать для тех, кто открывает приложение «в браузере» или по сохранённой ссылке/PWA с российского домена;
  - при желании — по гео/языку показывать в боте ссылку «Открыть в браузере» с URL зеркала для пользователей из РФ.
- **Авторизация** не привязана к домену: проверка `tg_auth` и выдача `chat_id` работают так же для любого фронта, который обращается к вашему API.

### Что нужно для запуска зеркала

1. Собрать фронт с нужным `VITE_API_URL` (общий или российский API).
2. Развернуть статику на российском хостинге, получить домен.
3. (Опционально) Развернуть копию/прокси API в РФ, если нужна полная локализация трафика.
4. В боте или в инструкциях дать пользователям из РФ ссылку на зеркало для открытия в браузере / добавления на рабочий стол.

---

## Кратко

| Вариант              | Описание                                                                 |
|----------------------|--------------------------------------------------------------------------|
| **Кабинет в боте**   | Текущий режим: Mini App по ссылке из бота, авторизация по initData.     |
| **Кабинет как сайт** | Тот же фронт по прямой ссылке или PWA; авторизация через tg_auth или initData. |
| **Зеркало для РФ**   | Тот же фронт (и при необходимости свой API) на российском хостинге, отдельный домен. |

Все три варианта используют **одну авторизацию через Telegram** и по сути один и тот же продукт: кабинет + сайт как копия/зеркало, в том числе версия для России на российском хостинге.
