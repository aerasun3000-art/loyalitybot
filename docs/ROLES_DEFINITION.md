# Чёткое разделение ролей в системе

> Документ определяет три основные роли платформы. **Не смешивать.** При добавлении нового функционала — проверять, к какой роли он относится.

---

## 1. Три роли (кратко)

| Роль | Кто | Что делает | Юр. статус | Таблица/сущность |
|------|-----|------------|------------|------------------|
| **Клиент** | Физлицо | Покупает у партнёров, получает баллы, приглашает друзей | Физлицо | `clients` (или users по chat_id) |
| **Партнёр-продавец** | Бизнес (салон, магазин, ИП, ООО) | Продаёт товары/услуги, начисляет кэшбэк, участвует в акциях | Юрлицо или ИП | `partners`, `partner_applications` |
| **Амбассадор** | Физлицо | Продвигает партнёров-продавцов, получает % с оборота по своей ссылке | Физлицо | `ambassadors` (будущая) |

---

## 2. Подробное описание ролей

### 2.1. Клиент (Client)

**Определение:** Пользователь, который покупает товары/услуги у партнёров и участвует в программе лояльности.

**Характеристики:**
- Вход через Telegram (chat_id)
- Имеет баланс баллов
- Может приглашать друзей (реферальная программа)
- Имеет уровень лояльности (Bronze, Silver, Gold, Platinum, Diamond) по балансу баллов
- **Не** получает деньги за продвижение (только баллы за рефералов)

**Где в системе:**
- Клиентский бот (`client-webhook`)
- Фронтенд: Home, Profile, Services, History, Community
- Таблицы: `clients` (если есть), данные по `chat_id` в транзакциях, рефералах

**Не путать с:** Амбассадор — это клиент с повышенными правами (Silver+), который **дополнительно** может продвигать партнёров за деньги.

---

### 2.2. Партнёр-продавец (Partner / Partner-Seller)

**Определение:** Бизнес (салон, магазин, мастер), который продаёт товары/услуги и участвует в программе лояльности как **продавец**.

**Характеристики:**
- Юридическое лицо или ИП
- Имеет услуги, акции, локацию
- Начисляет кэшбэк клиентам
- Получает клиентов через платформу
- Договор с платформой: B2B (оказание услуг, агентский и т.п.)
- Выплаты: расчёты за товар/услуги, комиссии платформе

**Где в системе:**
- Партнёрский бот (`partner-webhook`)
- Таблицы: `partners`, `partner_applications`, `services`, `partner_deals`
- Заявка: форма PartnerApply → `partner_applications` → одобрение → `partners`

**Не путать с:** Амбассадор — физлицо, которое **продвигает** партнёров, а не продаёт. Партнёр-продавец может в будущем **дополнительно** стать амбассадором (продвигать других партнёров), но это отдельная роль.

---

### 2.3. Амбассадор (Ambassador / Partner-Blogger)

**Определение:** Физлицо с уровнем Silver и выше, которое **продвигает** партнёров-продавцов и получает вознаграждение (% с оборота по своей ссылке).

**Характеристики:**
- Физлицо (не бизнес)
- Минимальный уровень: Silver (500+ баллов) — индикатор активности и лояльности
- Выбирает до 3 партнёров (Silver) или до 10 (Gold) для продвижения
- Имеет свой «магазин» (лендинг с рекомендованными партнёрами) — Gold+
- Получает **деньги** (не баллы) за привлечённый оборот
- Договор с платформой: ГПХ, агентский или оферта (B2C)
- Выплаты: платформа рассчитывается с амбассадором

**Где в системе (планируется):**
- Отдельная таблица `ambassadors` (не `partners`)
- Отдельный кабинет амбассадора (или раздел в клиентском приложении)
- Связь: `ambassador_id` → выбранные `partner_id`

**Не путать с:**
- **Партнёр-продавец** — продаёт свои услуги. Амбассадор — продвигает чужие.
- **Клиент-реферал** — получает баллы за приглашённых друзей. Амбассадор — получает деньги за привлечённых клиентов к партнёрам.

---

## 3. Сводная таблица различий

| Критерий | Клиент | Партнёр-продавец | Амбассадор |
|----------|--------|------------------|------------|
| **Тип** | Физлицо | Бизнес (ИП/ООО) | Физлицо |
| **Основное действие** | Покупает | Продаёт | Продвигает |
| **Получает** | Баллы, кэшбэк | Клиентов, выручку | % с оборота (деньги) |
| **Договор** | Оферта (пользовательское соглашение) | B2B с платформой | ГПХ/агентский/оферта |
| **Налоги** | — | Своя отчётность | НДФЛ (удержание или самозанятость) |
| **Порог входа** | Регистрация в боте | Заявка + одобрение | Silver+ (500 баллов) |
| **Таблица БД** | clients / users | partners | ambassadors |

---

## 4. Правила при разработке

### 4.1. Не смешивать роли в коде

- **Партнёр** и **амбассадор** — разные сущности. Не использовать `partners` для амбассадоров.
- При добавлении амбассадоров — создать отдельную таблицу `ambassadors` и отдельную логику.
- В UI: отдельный путь «Стать амбассадором» vs «Стать партнёром».

### 4.2. Один человек — несколько ролей

Один и тот же `chat_id` может быть:
- клиентом (всегда, если зарегистрирован);
- амбассадором (если Silver+ и подал заявку);
- партнёром-продавцом (если у него бизнес и заявка одобрена).

Проверка роли: `isPartner(chatId)` vs `isAmbassador(chatId)` — разные функции.

### 4.3. Выплаты

- **Партнёрам** — расчёты за товар/услуги, комиссии (B2B).
- **Амбассадорам** — вознаграждение за продвижение (B2C, НДФЛ).

Партнёры **не платят** амбассадорам напрямую. Платформа аккумулирует комиссию и сама рассчитывается с амбассадорами.

---

## 5. Схема данных (текущая и планируемая)

### Текущая

```
partner_applications (заявки на партнёрство)
    → partners (одобренные партнёры-продавцы)

clients / users (по chat_id в транзакциях, рефералах)
```

### Планируемая (амбассадоры)

```
ambassadors (
  chat_id TEXT PRIMARY KEY,
  created_at TIMESTAMP,
  status TEXT,           -- active, suspended
  max_partners INT,      -- 3 (Silver) или 10 (Gold)
  tier_at_signup TEXT,   -- Silver, Gold...
  ...
)

ambassador_partners (
  ambassador_id TEXT REFERENCES ambassadors(chat_id),
  partner_id TEXT REFERENCES partners(chat_id),
  ...
)
```

---

## 6. UI/UX: разделение потоков

| Действие | Куда ведёт | Роль |
|----------|------------|------|
| «Стать партнёром» | PartnerApply, форма с company_name, услуги, локация | Партнёр-продавец |
| «Стать амбассадором» | Отдельная форма/страница, проверка Silver+, выбор партнёров | Амбассадор |
| Покупка, баллы, рефералы | Home, Profile, Community | Клиент |
| Управление услугами, акциями | Партнёрский кабинет | Партнёр-продавец |
| Статистика по продвижению, вывод денег | Кабинет амбассадора | Амбассадор |

---

## 7. Чек-лист для новых фич

При добавлении функционала проверь:

- [ ] К какой роли относится? (клиент / партнёр / амбассадор)
- [ ] Используется ли правильная таблица/сущность?
- [ ] Нет ли смешения «партнёр» = «продавец» и «партнёр» = «блогер» в одном месте?
- [ ] В UI путь однозначный? (отдельная кнопка/страница для амбассадоров)

---

## 8. Терминология (единый глоссарий)

| Термин | Значение | Не использовать как |
|--------|----------|---------------------|
| **Партнёр** | Партнёр-продавец (бизнес) | Синоним амбассадора |
| **Амбассадор** | Физлицо, продвигает партнёров за деньги | Синоним партнёра |
| **Партнёр-блогер** | То же, что амбассадор | Отдельная роль от партнёра-продавца |
| **Клиент** | Физлицо, покупает и зарабатывает баллы | — |

---

*Документ создан для обеспечения чёткого разделения ролей. Обновлять при изменении модели.*
