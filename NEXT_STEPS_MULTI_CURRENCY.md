# üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò: –ú–£–õ–¨–¢–ò–í–ê–õ–Æ–¢–ù–û–°–¢–¨

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω ‚úÖ

---

## ‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û

1. ‚úÖ SQL –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
2. ‚úÖ `currency_utils.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤–∞–ª—é—Ç—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
3. ‚úÖ `supabase_manager.py` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã –ø—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
4. ‚úÖ `partner_revenue_share.py` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ USD –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ Revenue Share
5. ‚úÖ `frontend/src/utils/currency.js` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –≤–∞–ª—é—Ç—ã
6. ‚úÖ `frontend/src/utils/locations.js` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –≥–æ—Ä–æ–¥–∞ –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω

---

## üìã –ß–¢–û –î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï

### –®–ê–ì 1: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –ù—è—á–∞–Ω–≥–∞ (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ)
2. –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —á–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –±–æ—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Supabase, —á—Ç–æ –≤ `transactions.currency` —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ `'VND'`

**SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```sql
SELECT id, partner_chat_id, total_amount, currency, date_time
FROM transactions
ORDER BY date_time DESC
LIMIT 10;
```

---

### –®–ê–ì 2: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Revenue Share

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω:
   - –ü–∞—Ä—Ç–Ω–µ—Ä –∏–∑ –ù—è—á–∞–Ω–≥–∞: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 500,000 VND
   - –ü–∞—Ä—Ç–Ω–µ—Ä –∏–∑ NY: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è $100 USD
   
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—á–µ—Ç Revenue Share (—á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–±–æ—Ç–∞ –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç)

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Å—É–º–º—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ USD –∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–∫—Ä—ã—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –ù—è—á–∞–Ω–≥–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—É–º–º—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ VND (‚Ç´500,000)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –ê–ª–º–∞—Ç—ã (KZT)

---

### –®–ê–ì 4: –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –≤ –ë–î —É–∂–µ –µ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–∞–ª—é—Ç—ã, –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

**–§–∞–π–ª:** –°–æ–∑–¥–∞—Ç—å `migrations/update_existing_transactions_currency.sql`

```sql
-- –û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª—é—Ç—É –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
UPDATE transactions t
SET currency = (
    SELECT 
        CASE 
            WHEN p.city = 'Nha Trang' THEN 'VND'
            WHEN p.city IN ('–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', 
                           '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å', '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥') THEN 'RUB'
            WHEN p.city IN ('Almaty', 'Astana', '–ê–ª–º–∞—Ç—ã', '–ê—Å—Ç–∞–Ω–∞') THEN 'KZT'
            WHEN p.city IN ('Bishkek', 'Osh', '–ë–∏—à–∫–µ–∫', '–û—à') THEN 'KGS'
            WHEN p.city IN ('Dubai', '–î—É–±–∞–π') THEN 'AED'
            ELSE 'USD'
        END
    FROM partners p
    WHERE p.chat_id = t.partner_chat_id
)
WHERE t.currency IS NULL OR t.currency = 'USD';
```

---

## üö® –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—è currency
SELECT column_name 
FROM information_schema.columns 
WHERE table_name = 'transactions' AND column_name = 'currency';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∫—É—Ä—Å–æ–≤
SELECT * FROM currency_exchange_rates LIMIT 5;
```

---

## üìù –ß–ï–ö–õ–ò–°–¢ –ì–û–¢–û–í–ù–û–°–¢–ò –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

- [x] SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [x] –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∞–ª—é—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á–µ—Ç Revenue Share

---

**–ì–æ—Ç–æ–≤—ã –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** üöÄ
